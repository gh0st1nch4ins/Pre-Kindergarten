!function(modules){function webpackJsonpCallback(data){for(var moduleId,chunkId,chunkIds=data[0],moreModules=data[1],executeModules=data[2],i=0,resolves=[];i<chunkIds.length;i++)chunkId=chunkIds[i],installedChunks[chunkId]&&resolves.push(installedChunks[chunkId][0]),installedChunks[chunkId]=0;for(moduleId in moreModules)Object.prototype.hasOwnProperty.call(moreModules,moduleId)&&(modules[moduleId]=moreModules[moduleId]);for(parentJsonpFunction&&parentJsonpFunction(data);resolves.length;)resolves.shift()();return deferredModules.push.apply(deferredModules,executeModules||[]),checkDeferredModules()}function checkDeferredModules(){for(var result,i=0;i<deferredModules.length;i++){for(var deferredModule=deferredModules[i],fulfilled=!0,j=1;j<deferredModule.length;j++){var depId=deferredModule[j];0!==installedChunks[depId]&&(fulfilled=!1)}fulfilled&&(deferredModules.splice(i--,1),result=__webpack_require__(__webpack_require__.s=deferredModule[0]))}return result}var installedModules={},installedChunks={79:0},deferredModules=[];function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.r=function(exports){Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/javascripts/build/shared/";var jsonpArray=window.socrataFrontendWebpackJsonp=window.socrataFrontendWebpackJsonp||[],oldJsonpFunction=jsonpArray.push.bind(jsonpArray);jsonpArray.push=webpackJsonpCallback,jsonpArray=jsonpArray.slice();for(var i=0;i<jsonpArray.length;i++)webpackJsonpCallback(jsonpArray[i]);var parentJsonpFunction=oldJsonpFunction;deferredModules.push([1589,0]),checkDeferredModules()}({1583:function(module,exports,__webpack_require__){"use strict";_.get(window,"socrata.enable_2017_grid_view_refresh",!1)&&function($){function getColumnByColumnFieldName(view,columnFieldName){return _.find(_.get(view,"columns",[]),{fieldName:columnFieldName})}function vifOrderFromView(view){var orderBys=_.get(view,"query.orderBys");return _.isArray(orderBys)?orderBys.map(function(orderParam){var columnId=_.get(orderParam,"expression.columnId"),column=function(view,columnId){return _.find(_.get(view,"columns",[]),{id:columnId})}(view,columnId);return{ascending:orderParam.ascending,columnName:_.get(column,"fieldName")}}):null}$.fn.socrataTable=_.get(window,"blist.Visualizations.Table",function(){console&&console.error&&console.error("The Socrata Visualizations Table could not be instantiated because it is not defined.")}),$.fn.isSocrataVizDatasetGrid=function(){return!_.isUndefined($(this[0]).data("socrataVizDatasetGrid"))},$.fn.socrataVizDatasetGrid=function(options){var socrataVizDatasetGrid=$(this[0]).data("socrataVizDatasetGrid");return socrataVizDatasetGrid||(socrataVizDatasetGrid=new $.socrataVizDatasetGridObject(options,this[0])),socrataVizDatasetGrid},$.socrataVizDatasetGridObject=function(options,grid){this.settings=$.extend({},$.socrataVizDatasetGridObject.defaults,options),this.currentGrid=grid,this.init()},$.extend($.socrataVizDatasetGridObject,{defaults:{addColumnCallback:function(){},columnDeleteEnabled:!1,columnHideEnabled:!0,columnNameEdit:!1,columnPropertiesEnabled:!1,editColumnCallback:function(){},editEnabled:!0,manualResize:!1,showRowHandle:!1,showRowNumbers:!0,showAddColumns:!1,view:null},prototype:{init:function(){var currentStartIndex,currentEndIndex,lastRenderedVif,$datasetGrid,self=this,flyoutRenderer=new window.blist.Visualizations.views.FlyoutRenderer,configuredPageSize=_.get(window,"blist.configuration.gridView.rowsPerPage",null),pageSize=_.isNull(configuredPageSize)?50:parseInt(configuredPageSize,10);function renderTableFromScratch(){lastRenderedVif=null,loadRows(currentStartIndex=0,currentEndIndex=pageSize)}function loadRows(startIndex,endIndex){function renderTableForViews(currentView,parentView){var savedView=_.cloneDeep(_.get(self,"view._origObj",{})),tableColumnWidths={},rowLabelFromView=_.get(currentView,"metadata.rowLabel",null),rowLabelOne=null,rowLabelOther=null;currentView.newBackend=_.get(self,"view.newBackend",!1),currentView.columns.forEach(function(column){tableColumnWidths[column.fieldName]=column.width}),_.isEmpty(rowLabelFromView)?(rowLabelOne=$.t("core.default_row_label_one"),rowLabelOther=$.t("core.default_row_label_other")):(rowLabelOne=rowLabelFromView,rowLabelOther=$.pluralize(2,rowLabelFromView).substring(2));var newVifToRender={configuration:{order:vifOrderFromView(currentView),tableColumnWidths:tableColumnWidths,viewSourceDataLink:!1},format:{type:"visualization_interchange_format",version:3},series:[{dataSource:{datasetUid:self.view.id,domain:window.location.hostname,limit:endIndex-startIndex,offset:startIndex,type:"socrata.view",currentView:currentView,savedView:savedView,parentView:_.isUndefined(parentView)?null:parentView.cleanCopyIncludingRenderTypeName()},label:null,type:"table",unit:{one:rowLabelOne,other:rowLabelOther}}],title:null},renderVifEvent=new window.CustomEvent("SOCRATA_VISUALIZATION_RENDER_VIF",{detail:newVifToRender,bubbles:!1});0===$datasetGrid.children(".socrata-visualization").length?$datasetGrid.socrataTable(newVifToRender):$datasetGrid[0].dispatchEvent(renderVifEvent)}self.view.getParentView(function(parentView){var currentView=self.view.cleanCopyIncludingRenderTypeName(),firstChildViewId=_.get(self,"view.childViews[0]",null);"geo"!==_.get(self,"view.viewType")||_.isNull(firstChildViewId)?renderTableForViews(currentView,parentView):$.ajax({url:"/api/views/"+firstChildViewId+".json",type:"GET",headers:{"Content-type":"application/json","X-App-Token":_.get(window,"blist.configuration.appToken","")},success:function(geoFirstChildView){renderTableForViews(geoFirstChildView,parentView)},error:function(){console&&console.error&&console.error("Encountered error retrieving first child of geo view with id '"+firstChildViewId+"'."),renderTableForViews(currentView,parentView)}})}),_.isFunction(_.get(blist,"datasetPage.adjustSize"))&&setTimeout(blist.datasetPage.adjustSize,20)}function getCurrentUserColumns(){return _.get(self,"view.columns",[]).map(function(column){var cleanColumn=column.cleanCopy();return cleanColumn.format.hasOwnProperty("noCommas")&&(cleanColumn.format.noCommas="true"===cleanColumn.format.noCommas),cleanColumn.format.hasOwnProperty("precision")&&(cleanColumn.format.precision=parseInt(cleanColumn.format.precision,10)),cleanColumn}).filter(function(column){return column.id>=0}).sort(function(a,b){return _.get(a,"position",-1)<=_.get(b,"position",-1)?-1:1})}self.view=self.settings.view,self.view.bucketSize=pageSize,self.view.bind("query_change",renderTableFromScratch),self.view.bind("query_string_change",renderTableFromScratch),self.view.bind("columns_changed",function(){_.isFunction(_.get(blist,"datasetPage.sidebar.hide"))&&blist.datasetPage.sidebar.hide(),self.view.maybeEnableOrDisableDerivedViews2018Controls(),renderTableFromScratch()}),self.view.bind("row_change",renderTableFromScratch),$datasetGrid=$(self.currentGrid),renderTableFromScratch(),$datasetGrid.on("SOCRATA_VISUALIZATION_VIF_UPDATED",function(e){var updatedVif=e.originalEvent.detail,lastRenderedTableColumnWidths=_.get(lastRenderedVif,"configuration.tableColumnWidths",null),updatedTableColumnWidths=_.get(updatedVif,"configuration.tableColumnWidths",null);_.isEqual(lastRenderedTableColumnWidths,updatedTableColumnWidths)||function(tableColumnWidths){if("unpublished"===self.view.publicationStage){var newView=_.cloneDeep(self.view.cleanCopy());newView.columns.forEach(function(column){tableColumnWidths.hasOwnProperty(column.fieldName)&&(column.width=tableColumnWidths[column.fieldName])}),self.view.update(newView,!1,!1)}}(updatedTableColumnWidths)}),$datasetGrid.on("SOCRATA_VISUALIZATION_COLUMN_CLICKED",function(e){var newOrderBys,view=self.view.cleanCopyIncludingRenderTypeName(),columnId=_.get(getColumnByColumnFieldName(view,e.originalEvent.detail),"id"),existingOrderBys=_.cloneDeep(_.get(self,"view.query.orderBys",[])),newQuery=$.extend(!0,{},self.view.query);newOrderBys=1===existingOrderBys.length&&existingOrderBys[0].expression.columnId===columnId?[{ascending:!existingOrderBys[0].ascending,expression:{columnId:columnId,type:"column"}}]:[{ascending:!0,expression:{columnId:columnId,type:"column"}}],_.set(newQuery,"orderBys",newOrderBys),self.view.update({query:newQuery},!1,!0)}),$datasetGrid.on("SOCRATA_VISUALIZATION_ROW_DOUBLE_CLICKED",function(e){var isDefaultTabularViewOrMetadataTable=self.view.isDefault()&&"blist"===self.view.type||"metadata_table"===self.view.type,isWorkingCopy="unpublished"===self.view.publicationStage;if(isDefaultTabularViewOrMetadataTable&&isWorkingCopy){var payload=e.originalEvent.detail,rowEditorOptions={viewId:self.view.id,columns:payload.columns,row:{id:payload.row.id,data:payload.row.data}};window.blist.gridViewRowEditor(rowEditorOptions)}}),$datasetGrid.on("SOCRATA_VISUALIZATION_COLUMN_SORT_APPLIED",function(e){var view=self.view.cleanCopyIncludingRenderTypeName(),newOrderBys=[{ascending:e.originalEvent.detail.ascending,expression:{columnId:_.get(getColumnByColumnFieldName(view,e.originalEvent.detail.columnName),"id"),type:"column"}}],newQuery=$.extend(!0,{},self.view.query);_.set(newQuery,"orderBys",newOrderBys),self.view.update({query:newQuery},!1,!0)}),$datasetGrid.on("SOCRATA_VISUALIZATION_PAGINATION_PREVIOUS",function(){loadRows(currentStartIndex-=pageSize,currentEndIndex-=pageSize)}),$datasetGrid.on("SOCRATA_VISUALIZATION_PAGINATION_NEXT",function(){loadRows(currentStartIndex+=pageSize,currentEndIndex+=pageSize)}),$datasetGrid.on("SOCRATA_VISUALIZATION_FLYOUT",function(e){e.originalEvent.detail?flyoutRenderer.render(e.originalEvent.detail):flyoutRenderer.clear()}),$("#gridSidebar_outer_edit a.editColumn").live("click",function(){if(!$(this).hasClass("disabled")){var columnEditorOptions={columns:getCurrentUserColumns()};window.blist.gridViewColumnEditor(columnEditorOptions)}}),$("#gridSidebar_outer_edit a.addRow").live("click",function(){var rowEditorOptions={viewId:self.view.id,columns:getCurrentUserColumns(),row:{id:null,data:null}};window.blist.gridViewRowEditor(rowEditorOptions)}),$("#gridSidebar_outer_filter a.queryEditor").live("click",function(){window.blist.gridViewQueryEditor()})},isValid:function(){return!$.isBlank(this.view)}}})}(jQuery)},1584:function(module,exports,__webpack_require__){"use strict";!function($){$.fn.isDatasetGrid=function(){return!_.isUndefined($(this[0]).data("datasetGrid"))},$.fn.datasetGrid=function(options){var datasetGrid=$(this[0]).data("datasetGrid");return datasetGrid||(datasetGrid=new $.datasetGridObject(options,this[0])),datasetGrid},$.datasetGridObject=function(options,grid){this.settings=$.extend({},$.datasetGridObject.defaults,options),this.currentGrid=grid,this.init()},$.extend($.datasetGridObject,{defaults:{addColumnCallback:function(){},columnDeleteEnabled:!1,columnHideEnabled:!0,columnNameEdit:!1,columnPropertiesEnabled:!1,editColumnCallback:function(){},editEnabled:!0,manualResize:!1,showRowHandle:!1,showRowNumbers:!0,showAddColumns:!1,view:null},prototype:{init:function(){var datasetObj=this,$datasetGrid=datasetObj.$dom();$datasetGrid.data("datasetGrid",datasetObj),datasetObj.settings._filterCount=0,$datasetGrid.bind("column_sort.table",function(event,c,a){columnSorted(datasetObj,c,a)}).bind("clear_filter.table",function(event,c){clearColumnFilter(datasetObj,c)}).bind("column_moved.table",function(event,c,p){columnMove(datasetObj,c,p)}).bind("column_name_dblclick.table",function(event,origEvent){columnNameEdit(datasetObj,event,origEvent)}).bind("cellclick.table",function(e,r,c,o){cellClick(datasetObj,e,r,c,o)}).blistTable({cellNav:!0,selectionEnabled:!1,generateHeights:!1,columnDrag:!0,editEnabled:datasetObj.settings.editEnabled,headerMods:function(col){_headerMods(datasetObj,col)},rowMods:function(rows){_rowMods(datasetObj,rows)},manualResize:datasetObj.settings.manualResize,showGhostColumn:!0,showRowHandle:datasetObj.settings.showRowHandle,rowHandleWidth:15,showAddColumns:datasetObj.settings.showAddColumns,rowHandleRenderer:function(){return datasetObj.rowHandleRenderer.apply(datasetObj,arguments)},showRowNumbers:datasetObj.settings.showRowNumbers}).blistModel().options({blankRow:datasetObj.settings.editEnabled,filterMinChars:0}),$.live("#"+$datasetGrid.attr("id")+" .blist-table-row-handle","mouseover",function(e){hookUpRowMenu(datasetObj,this,e)}),$.live("#"+$datasetGrid.attr("id")+" .add-column","click",function(){datasetObj.settings.addColumnCallback()}),$.live("#"+$datasetGrid.attr("id")+" .blist-table-row-numbers a","click",function(e){rowMenuHandler(datasetObj,e)}),datasetObj._model=$datasetGrid.blistModel(),datasetObj.setView(datasetObj.settings.view),$(document).bind("cell_feed_shown",function(e,rowId,tcId){$(datasetObj.currentGrid).blistTableAccessor().setCommentCell(rowId,tcId)}),$(document).bind("cell_feed_hidden",function(e,rowId,tcId){$(datasetObj.currentGrid).blistTableAccessor().clearCommentCell(rowId,tcId)})},$dom:function(){return this._$dom||(this._$dom=$(this.currentGrid)),this._$dom},setView:function(newView){this._view&&this._view.unbind("grid_error_message"),this._view=newView,this._model.options({view:newView});var $dom=this.$dom();this._view.bind("grid_error_message",function(onRow,onCol,message){$('.blist-tr[id$="r'+onRow.id+'"] .blist-td[class*="c'+onCol.id+'"]',$dom).socrataTip({trigger:"now",isSolo:!0,message:message,parent:"body"})})},isValid:function(){return!$.isBlank(this._view)},disable:function(){this._disabled||(this._disabled=!0,this.$dom().blistTableAccessor().disable())},enable:function(){this._disabled&&(this.$dom().blistTableAccessor().enable(),delete this._disabled)},rowHandleRenderer:function(html,index,renderIndex,row,col,context){var isSubRow=!$.isBlank((col||{}).childColumns),colAdjust=isSubRow?"_"+col.lookup:"",options=[];isSubRow||options.push('<li class="pageView"><a href="',this._view.url,"/",row.id,'" class="noInterstitial noRedirPrompt">'+$.t("controls.grid.view_single_row")+"</a></li>"),this.settings.editEnabled&&context.permissions.canDelete&&options.push('<li class="delete"><a href="#row-delete#',row.id,colAdjust,'">'+$.t("controls.grid.delete_row")+"</a></li>"),_.isEmpty(options)||"blank"==row.type||html.push('<a class="menuLink" href="#row-menu#',row.id,colAdjust,'"','aria-label="',$.t("controls.grid.view_single_row"),'"></a>','<ul class="menu rowMenu" id="row-menu_',row.id,colAdjust,'">',options.join(""),'<li class="footer"><div class="outerWrapper">','<div class="innerWrapper"><span class="colorWrapper"></span></div>',"</div></li></ul>")}}});var hookUpRowMenu=function(datasetObj,curCell){var $cell=$(curCell);$cell.data("row-menu-applied")||($cell.find("ul.menu").dropdownMenu({menuContainerSelector:".blist-table-row-handle",triggerButtonSelector:"a.menuLink",openCallback:function($menuElement){rowMenuOpenCallback(datasetObj,$menuElement)},linkCallback:function(event){rowMenuHandler(datasetObj,event)},pullToTop:!0}),$cell.data("row-menu-applied",!0))},rowMenuOpenCallback=function(){},rowMenuHandler=function(datasetObj,event){event.preventDefault();var action,rowId,href=$(event.currentTarget).attr("href"),hashIndex=href.indexOf("#");if(!(hashIndex<0)||$.isBlank(href.match(/\/\d+$/))&&$.isBlank(href.match(/\/row-/))){var s=href.slice(hashIndex+1).split("#");if(s.length<2)return;if(action=s[0],!(rowId=s[1]).match(/row-(?:[a-z0-9]{4}[-_~\.]){2}[a-z0-9]{4}/)){var splitRowId=rowId.split("_");rowId=splitRowId[0],splitRowId[1]&&s.push(splitRowId[1])}}else action="view-row",rowId=href.slice(href.lastIndexOf("/")+1);var model=datasetObj._model;switch(action){case"row-delete":if($.isBlank(s[2]))model.removeRows(rowId);else{var col=datasetObj._view.columnForID(s[2]);model.removeChildRows(model.getByID(rowId),col)}break;case"view-row":$(document).trigger(blist.events.DISPLAY_ROW,[rowId])}},cellClick=function(datasetObj,event,row,column,origEvent){var model=datasetObj._model;row.level>0||($.isBlank(column)||"rowNumberCol"==column.id?origEvent.shiftKey?model.selectRowsTo(row):model.toggleSelectRow(row):$(origEvent.target).closest(".blist-column-adder-icon").length>0&&(event.preventDefault(),datasetObj.settings.addColumnCallback(column.id)))},_rowMods=function(datasetObj,renderedRows){_.each(renderedRows,function(r){var $row=$(r.row);if(!$row.is(".blist-tr-open"))return!0;$row.find(".blist-tdh[colId]").each(function(i,tdh){var $tdh=$(tdh);if($tdh.hasClass("setup"))return!0;var parColId=$tdh.attr("parentColId"),parCol=datasetObj._view.columnForID(parColId);if(!$.isBlank(parCol)){var colId=$tdh.attr("colId"),col=parCol.childColumnForID(colId);$.isBlank(col)||setupHeader(datasetObj,col,$tdh,!1)}})})},setupHeader=function(datasetObj,col,$col,tipsRef){var nested=$col.hasClass("blist-tdh"),$menuLink=$col.find(".menuLink");$col.columnMenu({column:col,$menuTrigger:$menuLink,columnDeleteEnabled:datasetObj.settings.columnDeleteEnabled,columnHideEnabled:datasetObj.settings.columnHideEnabled,columnPropertiesEnabled:datasetObj.settings.columnPropertiesEnabled,editColumnCallback:datasetObj.settings.editColumnCallback,selectedColumns:function(){return $(datasetObj.currentGrid).blistTableAccessor().getSelectedColumns()},view:datasetObj._view});var tip=$col.find(".menuLink").socrataTip({message:$.t("controls.grid.menu"),parent:"body",shrinkToFit:!0,trigger:"hover",isSolo:!1});$menuLink.click(function(){tip.hide()}),$col.addClass("setup");var $infoButton=$col.find(".info-button"),$infoWrapper=$col.find(".button-wrapper");if(col.renderType.sortable&&!nested&&$col.find(".blist-th-name").socrataTip({trigger:"hover",message:$.t("controls.grid.click_to_sort"),parent:"body",isSolo:!0}),tipsRef||nested){var tooltipContent=blist.datasetControls.getColumnTip(col);$infoWrapper.socrataTip({content:tooltipContent,trigger:"mouseenter click",parent:"body",isSolo:!0,shownCallback:function(){$($infoWrapper.socrataTip()._tipBox).mouseleave(function(){$($infoWrapper.socrataTip().hide())})}})}$infoWrapper.click(function(){$infoButton.socrataTip().quickHide()})},_headerMods=function(datasetObj,col){datasetObj.settings._colTips||(datasetObj.settings._colTips={}),setupHeader(datasetObj,col,$(col.dom),datasetObj.settings._colTips)},columnSorted=function(datasetObj,column,ascending){$(column.dom).columnMenu().sort(ascending)},clearColumnFilter=function(datasetObj,col){$(col.dom).columnMenu().clearFilter()},columnMove=function(datasetObj,col,newPos){var visColIds=_.pluck(datasetObj._view.visibleColumns,"id"),oldPos=_.indexOf(visColIds,col.id);visColIds.splice(newPos,0,col.id),visColIds.splice(newPos<oldPos?oldPos+1:oldPos,1),datasetObj._view.setVisibleColumns(visColIds,null,datasetObj._view.temporary)},columnNameEdit=function(datasetObj,event,origEvent){if(datasetObj.settings.columnNameEdit&&!datasetObj._view.temporary){var $target=$(origEvent.currentTarget).find(".blist-th-name"),$th=$target.closest(".blist-th").addClass("editable"),$container=$target.closest(".name-wrapper"),$edit=$container.find("form");$edit.length<1&&($container.append('<form class="action-item"><input type="text" /></form>'),($edit=$container.find("form")).submit(function(e){columnEditSubmit(datasetObj,e)}).find(":input").keydown(function(e){columnEditKeyHandler(datasetObj,e)})),$edit.find(":input").removeAttr("disabled").val($target.text()).focus().select(),$(document).bind("mousedown.columnNameEdit-"+$th.data("column").id,function(e){columnEditDocMouse(datasetObj,e,$th)}).bind("mouseup.columnNameEdit-"+$th.data("column").id,function(e){columnEditDocMouse(datasetObj,e,$th)})}},columnEditEnd=function(datasetObj,$th){datasetObj.$dom().focus(),$th.removeClass("editable error"),$(document).unbind(".columnNameEdit-"+$th.data("column").id)},columnEditSave=function(datasetObj,$th){var $input=$th.find(":input"),newName=$input.val();if(""===newName)return alert($.t("controls.grid.must_enter_name")),void $th.addClass("error");if($th.find(".blist-th-name").text()!=newName){var col=datasetObj._view.columnForID($th.data("column").id);col.update({name:newName}),$input.attr("disabled","disabled"),col.save(function(){columnEditEnd(datasetObj,$th)},function(xhr){var errBody=JSON.parse(xhr.responseText);alert(errBody.message),$th.addClass("error"),$input.removeAttr("disabled")})}else columnEditEnd(datasetObj,$th)},columnEditDocMouse=function(datasetObj,event,$th){var $target=$(event.target);$target.is(".name-wrapper :input")&&$target.parents().index($th)>=0||$target.closest("#jqmAlert").length>0||columnEditSave(datasetObj,$th)},columnEditSubmit=function(datasetObj,event){event.preventDefault(),columnEditSave(datasetObj,$(event.target).closest(".blist-th"))},columnEditKeyHandler=function(datasetObj,event){27==event.keyCode&&columnEditEnd(datasetObj,$(event.target).closest(".blist-th"))}}(jQuery)},1585:function(module,exports,__webpack_require__){"use strict";blist.namespace.fetch("blist.data"),blist.data.TableNavigation=function(_model,_layout,_$textarea){var model=_model;this.updateModel=function(_newModel){model=_newModel};var layout=_layout;this.updateLayout=function(_newLayout){layout=_newLayout};var activeCellXStart,activeCellXCount,activeCellY,$textarea=_$textarea,activeCellOn=!1,selectionLevel=-1,selectionBoxes=[],selectedColumns={};this.lastSelectedColumn=null;var hasSelection=function(){if(selectionBoxes.length)return!0;for(var col in selectedColumns)return!0;return!!model.hasSelectedRows()};this.goTo=function(x,y,event,selecting,wrap){var selectionMode;event||(event={}),selecting||event.shiftKey?selectionMode=selectionBoxes.length?"continue":"start":event.metaKey?selectionMode="start-new":hasSelection()&&(selectionBoxes=[],selectedColumns={},this.lastSelectedColumn=null);var row=model.get(y),rowLevel=void 0!==row&&row.level||0;if(hasSelection()&&selectionLevel!=rowLevel)return!1;var selection,layoutLevel=layout[rowLevel],xNum=1,col=layoutLevel[x],uid=col.logical;if(wrap&&void 0!==row&&!row.expanded&&("opener"==col.renderTypeName||"header"==col.renderTypeName)){var subT=model.getRowValue(row,col.mcol);(model.useBlankRows()||subT&&subT.length>0)&&model.expand(row)}if(!(void 0!==row&&row.expanded&&wrap||"opener"!=col.renderTypeName&&"header"!=col.renderTypeName))for(var i=x+1;i<layoutLevel.length&&layoutLevel[i].logical==uid;i++)xNum++;if(void 0!==row&&row.expanded&&wrap&&("opener"==col.renderTypeName||"header"==col.renderTypeName)){var newXY=getAdjustedY(1,event,x,y,wrap);newXY&&(x=newXY.x,y=newXY.y,rowLevel=(row=model.get(y)).level||0,uid=(col=(layoutLevel=layout[rowLevel])[x]).logical)}if("start"==selectionMode||"start-new"==selectionMode){if(!selectionBoxes.length){var curRow=model.get(y);selectionLevel=void 0!==curRow&&curRow.level||0}var startX="start"==selectionMode&&activeCellOn?activeCellXStart:x,startY="start"==selectionMode&&activeCellOn?activeCellY:y;selectionBoxes.push(selection=[startX,startY])}else"continue"==selectionMode&&(selection=selectionBoxes[selectionBoxes.length-1]);return selection&&(selection[2]=x<selection[0]?x:x+xNum-1,selection[3]=y),activeCellOn=!0,activeCellXStart=x,activeCellXCount=xNum,activeCellY=y,!0},this.selectionInit=function(selectFrom){var needInit=!0;if(selectionBoxes.length){var box=selectionBoxes[selectionBoxes.length-1];box[0]==selectFrom.x&&box[1]==selectFrom.y&&(needInit=!1)}return!needInit||(this.deactivate(),!1)},this.initCopy=function(){hasSelection()?($textarea.val("x"),$textarea[0].select()):$textarea.val("")},this.processSelection=function(){},this.isActive=function(){return activeCellOn},this.getActiveX=function(){return activeCellXStart},this.getActiveXEnd=function(){return activeCellXStart+activeCellXCount},this.getActiveWidth=function(){return activeCellXCount},this.getActiveY=function(){return activeCellY},this.deactivate=function(){activeCellOn=!1},this.clearAll=function(){var needRefresh=!1;return activeCellOn&&(activeCellOn=!1,needRefresh=!0),hasSelection()&&(selectionBoxes=[],selectedColumns={},this.lastSelectedColumn=null,needRefresh=!0),$textarea.val(""),needRefresh};var getColumnInLevel=function(newMCol,row){for(var newL=void 0!==row&&row.level||0,newLevelLayout=layout[newL],x=null,i=0;i<newLevelLayout.length;i++)if(newLevelLayout[i].mcol==newMCol){x=i;break}return x==newLevelLayout.length?null:x},getAdjustedY=function getAdjustedY(deltaY,event,baseX,baseY,wrap){var y=baseY;if(void 0===y)return null;y+=deltaY;var x=baseX,oldRow=model.get(baseY),oldLevel=void 0!==oldRow&&oldRow.level||0,oldCol=layout[oldLevel][baseX];if(wrap&&(y<0||y>=model.length()))if("header"!=oldCol.renderTypeName&&"opener"!=oldCol.renderTypeName&&oldCol.mcol&&oldCol.mcol.parentColumn&&(oldCol.mcol.indexInLevel>0&&deltaY<0||oldCol.mcol.indexInLevel<oldCol.mcol.parentColumn.visibleChildColumns.length-1&&deltaY>0))y+=(deltaY<0?1:-1)*oldRow.parent.childRows.length,x+=deltaY<0?-1:1;else{if("header"==oldCol.renderTypeName)for(var h=0;h<layout[oldLevel].length;h++)if(layout[oldLevel][h].mcol==oldCol.mcol.parentColumn){x=h;break}var newY=y<0?model.length()-1:0;if(oldCol.mcol&&oldCol.mcol.parentColumn){if(null===(x=getColumnInLevel(oldCol.mcol.parentColumn,model.get(newY))))return null}else{var curRow=model.get(newY);if((void 0!==curRow&&curRow.level||0)>oldLevel){var adjHeader=layout[oldLevel][x+(deltaY<0?-1:1)];if(adjHeader&&"header"==adjHeader.renderTypeName&&adjHeader.mcol&&adjHeader.mcol.parentColumn){if(null===(x=getColumnInLevel(adjHeader.mcol,model.get(newY))))return null;x+=deltaY<0?1:-1}else newY=model.nextInLevel(newY+(deltaY<0?1:-1),deltaY<0)}}var adjX=getAdjustedX(y<0?-1:1,event,x,newY);!adjX||adjX.x==x&&adjX.y==y||(x=adjX.x,y=adjX.y)}if(y<0&&(y=0),y>=model.length()&&(y=model.length()-1),y==baseY&&x==baseX)return null;var newRow=model.get(y),newLevel=void 0!==newRow&&newRow.level||0,newCol=layout[newLevel][x];if(wrap&&baseX==x&&oldCol.mcol&&oldCol.mcol.parentColumn&&void 0!==oldRow&&oldRow.parent&&(void 0===newRow||!newRow.parent||newRow.parent!=oldRow.parent))if(0==oldCol.mcol.indexInLevel&&deltaY<0||oldCol.mcol.indexInLevel==oldCol.mcol.parentColumn.visibleChildColumns.length-1&&deltaY>0){if(null===(x=getColumnInLevel(oldCol.mcol.parentColumn,newRow)))return null;newCol=layout[newLevel][x]}else{var childRows=oldRow.parent.childRows,ntY=model.index(deltaY<0?childRows[childRows.length-1]:childRows[0]),adjXNT=getAdjustedX(deltaY<0?-1:1,event,x,ntY);adjXNT&&(x=adjXNT.x,y=adjXNT.y,newLevel=void 0!==(newRow=model.get(y))&&newRow.level||0,newCol=layout[newLevel][x])}if(newCol&&("opener"==newCol.renderTypeName||"header"==newCol.renderTypeName)){if(void 0!==newRow&&newRow.expanded&&wrap)return getAdjustedY(deltaY<0?-1:1,event,x,y,wrap);for(var targetCol="nested_table"==newCol.mcol.renderTypeName?newCol.mcol:newCol.mcol.parentColumn,j=0;j<layout[newLevel].length;j++)if(layout[newLevel][j].mcol==targetCol)return{x:x=j,y:y}}if(newLevel!=oldLevel&&baseX==x){if(event.shiftKey||event.metaKey)var needScan=!0;else if(newLevel>oldLevel)if(oldCol.mcol&&oldCol.mcol.visibleChildColumns)var newMCol=oldCol.mcol.visibleChildColumns[0];else oldCol.mcol&&oldCol.mcol.parentColumn?newMCol=oldCol.mcol:needScan=!0;else newLevel<oldLevel&&oldCol.mcol&&oldCol.mcol.parentColumn?newMCol=oldCol.mcol.parentColumn:needScan=!0;if(needScan){if(y=model.nextInLevel(baseY,deltaY<0),$.isBlank(y)){if(!wrap)return null;var wrapY=deltaY<0?model.length()-1:0,wrapXY=getAdjustedX(deltaY<0?-1:1,event,x,wrapY);return wrapXY&&wrapXY.x!=x?wrapXY:null}newCol=layout[oldLevel][x]}else{if(!newMCol)return null;if(null===(x=getColumnInLevel(newMCol,newRow)))return null;newCol=layout[newLevel][x]}}if(newCol&&newCol.mcol&&(newCol.mcol.parentColumn||"nest-header"==newCol.renderTypeName)&&!model.getRowValue(newRow,"nest-header"==newCol.renderTypeName?newCol.mcol:newCol.mcol.parentColumn)){var adjDelta=deltaY<0?-1:1;return!wrap&&y+adjDelta>=model.length()?null:getAdjustedY(adjDelta,event,x,y,wrap)}return{x:x,y:y}},getAdjustedX=function getAdjustedX(deltaX,event,baseX,baseY,wrap){for(var curRow,adjRow,y=baseY,origRow=model.get(y),origLevel=void 0!==origRow&&origRow.level||0,layoutLevel=layout[origLevel],x=baseX,prevCol=layoutLevel[x],cellsToMove=Math.abs(deltaX),delta=deltaX/cellsToMove,i=0;i<cellsToMove;i++){for(var newX=x+delta;newX>=0&&newX<layoutLevel.length;newX+=delta){var curCol=layoutLevel[newX];if(wrap&&prevCol&&prevCol.mcol&&prevCol.mcol.parentColumn&&(!curCol.mcol||curCol.mcol.parentColumn!=prevCol.mcol.parentColumn)){var dY=delta<0?-1:1,adjX=newX+(delta<0?1:-1)*prevCol.mcol.parentColumn.visibleChildColumns.length,adjP=getAdjustedY(dY,event,adjX,y);if(adjP&&(adjRow=model.get(adjP.y),curRow=model.get(y),origLevel==(void 0!==adjRow&&adjRow.level||0)&&(void 0!==curRow?curRow.parent:void 0)==(void 0!==adjRow?adjRow.parent:void 0))){y=adjP.y,newX=adjP.x,curRow=model.get(y),layoutLevel=layout[void 0!==curRow&&curRow.level||0];break}}if("nest-header"!=curCol.renderTypeName&&"header"!=curCol.renderTypeName){if(curCol.mcol&&"nested_table"==curCol.mcol.renderTypeName&&void 0!==(curRow=model.get(y))&&curRow.expanded){var subTable=model.getRowValue(curRow,curCol.mcol);if(!model.useBlankRows()&&(!subTable||subTable.length<1))continue}if("fill"==curCol.renderTypeName||prevCol&&prevCol.mcol&&prevCol.mcol.parentColumn&&curCol.mcol&&curCol.mcol.parentColumn&&curCol.mcol.parentColumn!=prevCol.mcol.parentColumn){if(void 0===(curRow=model.get(y)))return null;var newRow=curRow.parent;if(curCol.mcol&&curCol.mcol.parentColumn&&void 0!==newRow&&newRow.expanded){var subT=model.getRowValue(newRow,curCol.mcol.parentColumn);if(!model.useBlankRows()&&(!subT||subT.length<1))continue}return y=model.index(newRow),null===(x=getColumnInLevel(prevCol.mcol.parentColumn,newRow))?null:(curCol=(layoutLevel=layout[void 0!==newRow&&newRow.level||0])[x],getAdjustedX(deltaX,event,x,y,wrap))}if(!1!==curCol.canFocus)break}}if(newX<0||newX>=layoutLevel.length){if(!wrap)break;if(prevCol&&prevCol.mcol&&prevCol.mcol.parentColumn&&(dY=delta<0?-1:1,adjX=newX+(delta<0?1:-1)*prevCol.mcol.parentColumn.visibleChildColumns.length,null!==(adjP=getAdjustedY(dY,event,adjX,y))&&(adjRow=model.get(adjP.y),curRow=model.get(y),origLevel==(void 0!==adjRow&&adjRow.level||0)&&(void 0!==curRow?curRow.parent:void 0)==(void 0!==adjRow?adjRow.parent:void 0)))){y=adjP.y,x=adjP.x,curRow=model.get(y),prevCol=(layoutLevel=layout[void 0!==curRow&&curRow.level||0])[newX];continue}if(void 0!==(curRow=model.get(y))&&curRow.parent&&(curRow=curRow.parent),null==(y=model.nextInLevel(model.index(curRow),delta<0)))return null;newX=newX<0?layoutLevel.length:-1,curRow=model.get(y),layoutLevel=layout[void 0!==curRow&&curRow.level||0],i--}prevCol=layoutLevel[x=newX]}return{x:x,y:y}},preNav=function(){return!activeCellOn&&model.length()&&model.columns()[0]?{x:0,y:0}:null};return this.navigateY=function(deltaY,event,wrap){var xy=preNav();return xy||(xy=getAdjustedY(deltaY,event,activeCellXStart,activeCellY,wrap)),xy},this.navigateX=function(deltaX,event,wrap){var xy=preNav();return xy||(xy=getAdjustedX(deltaX,event,activeCellXStart,activeCellY,wrap)),(!xy||xy.x==activeCellXStart&&xy.y==activeCellY)&&(xy=null),xy},this.setColumnSelection=function(column,value){if(hasSelection()){if(0!=selectionLevel)return}else selectionLevel=0;selectedColumns[column.id]=value,value&&(this.lastSelectedColumn=column)},this.isColumnSelected=function(column){return selectedColumns[column.id]},this.getSelectedColumns=function(){var rv={};return _.each(selectedColumns,function(val,colId){val&&(rv[colId]=val)}),rv},this.clearColumnSelection=function(){selectedColumns={},this.lastSelectedColumn=null},this.getSelectionDoc=function(){var renderContextVars={rawDoc:[]};if(!hasSelection()){if(activeCellOn){var row=model.get(activeCellY),col=model.columns()[activeCellXStart];if(void 0!==row&&void 0!==col&&!$.isBlank(col.lookup)){var type=col.renderType||blist.datatypes.text;renderContextVars.row=row;var value=type.renderer(row.data[col.lookup],col,!0);if(void 0!=value)return value}}return""}return""},this}},1586:function(module,exports,__webpack_require__){"use strict";_.get(window,"socrata.enable_2017_grid_view_refresh",!1)||function($){var nextTableID=1,htmlEscape=function(text){return text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},trace=!1;if(trace=trace&&window.console,window.console&&!window.console.time){var traceTimes={};window.console.time=function(what){traceTimes[what]=(new Date).getTime()},window.console.timeEnd=function(what){var diff=(new Date).getTime()-traceTimes[what];$.debug("[Time] "+what+": "+diff),delete traceTimes[what]}}var begin=trace?function(what){console.time(what)}:function(){},end=trace?function(what){console.timeEnd(what)}:function(){},makeTable=function(options){var model,dsReady=!1,id=this.id;id||(id="blist-t"+(id=nextTableID++),this.id=id);var cellNav,$activeCells,$activeContainer,$curRenderActiveCells,hotExpander,hotExpanderVisible,hotCell,hotRowID,hotCellTimer,hotHeader,hotHeaderMode,skipHeaderClick,mouseDownAt,dragHeaderLeft,clickTarget,clickCell,selectFrom,touchLastY,touchLastX,$prevActiveCells,$this=$(this),calculateHandleDigits=function(){return Math.ceil(Math.log(model.length()||1)*Math.LOG10E)},getRow=function(cell){var rowDOM=cell.parentNode;if(!rowDOM)return null;var rowID=rowDOM.id.substring(id.length+2);return model.getByID(rowID)},getColumn=function(cell){var classIndex=cell.className.indexOf(id+"-c");if(-1==classIndex)return null;var endOfID=cell.className.indexOf(" ",classIndex);-1==endOfID&&(endOfID=cell.className.length);var colID=cell.className.slice(classIndex+id.length+2,endOfID);return"rowHandleCol"==colID?rowHandleColumn:"rowNumberCol"==colID?rowNumberColumn:model.columnForID(colID)},getColumnWidthPx=function(col){return"opener"==col.renderTypeName?openerWidth+paddingX:(col.mcol&&(col=col.mcol),(col.width||parseFloat(getColumnStyle(col).width))+paddingX)},selectColumn=function(column,state){cellNav&&(cellNav.setColumnSelection(column,state),state&&model.unselectAllRows(),updateColumnSelection(),updateCellNavCues())},updateColumnSelection=function(){if(cellNav)for(var i=0;i<columns.length;i++){var mcol=columns[i],col=$header.find("."+id+"-c"+mcol.id),colClass=getColumnClass(mcol);if(cellNav.isColumnSelected(mcol)){if(!col.is(".blist-select-col")){var colLeft=col.addClass("blist-select-col").offset().left;inside.append('<div class="col-select-holder blist-table-util '+colClass+'"/>').find(".col-select-holder."+colClass).css("left",colLeft-$header.offset().left+lockedWidth).removeClass("blist-table-util")}}else col.is(".blist-select-col")&&(col.removeClass("blist-select-col"),inside.find(".col-select-holder."+colClass).remove())}},clearRowSelection=function(row){if(void 0!==row.row)for(var cell=row.row.firstChild;cell;cell=cell.nextSibling)cell._sel&&($(cell).removeClass("blist-cell-selected"),cell._sel=!1);delete row.selected},setRowSelection=function(row,selmap){row.selected=!0;for(var pos=0,node=row.row.firstChild;node;node=node.nextSibling,pos++)selmap[pos]?node.selected||($(node).addClass("blist-cell-selected"),node._sel=!0):node._sel&&($(node).removeClass("blist-cell-selected"),node._sel=!1)},focus=function(){$navigator[0].focus()},updateCellNavCues=function(){if(cellNav){if(cellNav.isActive()){var row=model.get(cellNav.getActiveY());if(void 0!==row){var physActive=renderedRows[row.id];if(physActive)var $newActive=$(physActive.row).children().slice(cellNav.getActiveX(),cellNav.getActiveXEnd())}$activeCells=$newActive||null}var rows=function(){var rows=[];for(var rowId in renderedRows){var row=renderedRows[rowId];rows.push(row)}return _.sortBy(rows,function(r){return model.index(r)})}();cellNav.processSelection(rows,setRowSelection,clearRowSelection),cellNav.initCopy()}},hideActiveCell=function(activeOnly){$activeContainer&&($activeContainer.css("top",-1e4),$activeContainer.css("left",-1e4)),activeOnly||endEdit(!0,SELECT_EDIT_MODE)},expandActiveCell=function(){if(!isEdit[DEFAULT_EDIT_MODE]&&cellNav.isActive())if(isEdit[SELECT_EDIT_MODE])hideActiveCell(!0);else{var column;if($activeCells&&$activeCells.length>0){var type=(column=getColumn($activeCells[0]))?column.renderType:null;if(type&&type.isInlineEdit&&editCell($activeCells[0],SELECT_EDIT_MODE))return}$activeContainer?null!=$activeContainer[0].parentNode&&11!=$activeContainer[0].parentNode.nodeType||$render.append($activeContainer):($activeContainer=$('<div class="blist-table-active-container blist-table-util"></div>'),$render.append($activeContainer));var row=model.get(cellNav.getActiveY());if(void 0!==row&&row.expanded?$activeContainer.addClass("blist-tr-open"):$activeContainer.removeClass("blist-tr-open"),$activeCells){column||(column=getColumn($activeCells[0]));var $activeExpand=$activeCells.clone();$activeExpand.width("auto").height("auto"),$activeContainer.width("auto").height("auto"),$activeCells!=$curRenderActiveCells&&($.isBlank($curRenderActiveCells)||$activeCells.index($curRenderActiveCells)<0)&&($activeContainer.empty(),$activeContainer.append($activeExpand),$curRenderActiveCells=$activeCells),$activeContainer.toggleClass("comments-active",$activeCells.hasClass("comments-active")),sizeCellOverlay($activeContainer,$activeExpand,$activeCells,null),positionCellOverlay($activeContainer,$activeCells),$activeContainer.removeClass("blist-table-util")}else{$activeContainer.empty(),$activeContainer.height(rowOffset-($activeContainer.outerHeight()-$activeContainer.height()));for(var width=0,j=cellNav.getActiveX(),stop=cellNav.getActiveXEnd();j<stop;j++)width+=getColumnWidthPx(layout[0][j]);$activeContainer.width(width-($activeContainer.outerWidth()-$activeContainer.width()));var rowIndex=cellNav.getActiveY();$activeContainer.css("top",rowIndex*renderScaling-$render.position().top);for(var left=lockedWidth,i=0;i<cellNav.getActiveX();i++)left+=getColumnWidthPx(layout[0][i]);$activeContainer.css("left",left)}}else hideActiveCell()},clearCellNav=function(){cellNav&&cellNav.clearAll()&&($activeCells=null,updateColumnSelection(),updateCellNavCues(),expandActiveCell(),inside.find(".col-select-holder").remove())},cellXY=function(cell){var row=getRow(cell);if(!row)return null;var x,node,lcol,levelID=row.level||0,rowLayout=layout[levelID];for(x=0,node=cell.parentNode.firstChild;node&&(lcol=rowLayout[x])&&node!=cell;node=node.nextSibling)lcol.skippable&&$(node).hasClass("blist-skip")&&(x+=lcol.skipCount),x++;return void 0===lcol?null:{x:x,y:model.index(row)}},cellNavTo=function(cell,event,selecting){var cellLoc=cellXY(cell);if(!cellLoc)return clearCellNav(),!1;if(event){var $target=$(event.target);if($target.closest(".blist-table-locked").length>0||!selecting&&$target.closest(".blist-tdh")>0||$target.is(".blist-table-expander"))return!1}return model.unselectAllRows(),$target&&$target.is("a")&&!selecting?(clearCellNav(),!0):cellNavToXY(cellLoc,event,selecting)},cellNavToXY=function(xy,event,selecting,wrap){if(!cellNav.goTo(xy.x,xy.y,event,selecting,wrap))return!1;if(xy.x=cellNav.getActiveX(),xy.y=cellNav.getActiveY(),event){var scrollTop=$scrolls[0].scrollTop,firstRow=scrollTop/renderScaling,lastRow=firstRow+pageSize-2,origScrollTop=scrollTop;xy.y>lastRow&&(scrollTop=Math.ceil((xy.y-(pageSize-2))*renderScaling)),xy.y<firstRow&&(scrollTop=Math.floor(xy.y*renderScaling)),scrollTop!=origScrollTop&&$scrolls.scrollTop(scrollTop);var scrollLeft=$scrolls.scrollLeft(),scrollWidth=$scrolls.width();$scrolls[0].scrollHeight>$scrolls[0].clientHeight&&(scrollWidth-=scrollbarWidth);for(var scrollRight=scrollLeft+scrollWidth,row=model.get(xy.y),layoutLevel=layout[void 0!==row&&row.level||0],cellLeft=lockedWidth,i=0;i<xy.x;i++)cellLeft+=getColumnWidthPx(layoutLevel[i]);for(var cellRight=cellLeft,j=0;j<cellNav.getActiveWidth();j++)cellRight+=getColumnWidthPx(layoutLevel[xy.x+j]);cellRight>scrollRight&&$scrolls.scrollLeft(cellRight-scrollWidth),cellLeft-lockedWidth<scrollLeft&&$scrolls.scrollLeft(cellLeft-lockedWidth)}return killHotExpander(),updateCellNavCues(),!0},$editContainers={},isEdit={},DEFAULT_EDIT_MODE="edit",SELECT_EDIT_MODE="select",canEdit=function(){return options.editEnabled&&model.canWrite()},editCell=function(cell,mode,newValue){if(mode||(mode=DEFAULT_EDIT_MODE),isEdit[mode])return!1;if(!canEdit())return mode==DEFAULT_EDIT_MODE&&$(cell).trigger("attempted_edit"),!1;var row=getRow(cell),col=getColumn(cell);if(!col||"rowHandleCol"==col.id||"rowNumberCol"==col.id||col.isLinked()||!row)return!1;var value=model.getRowValue(row,col);value||(value=model.getInvalidValue(row,col));var $curEditContainer=$('<div class="blist-table-edit-container mode-'+mode+' blist-table-util"></div>');$scrolls.append($curEditContainer);var realCol=model.columnForID(col.id);return $.isBlank(realCol.renderType.interfaceType)?void 0:($curEditContainer.blistEditor({type:realCol.renderType,row:row,value:value,newValue:newValue,colLookup:realCol.lookup,modelView:model.view,format:realCol.format,customProperties:{dropDownList:realCol.dropDownList,baseUrl:realCol.baseUrl()}}),$curEditContainer.data("realColumn",realCol),configureEditor(cell,$curEditContainer,mode),"expand"==mode&&$curEditContainer.bind("editor-change",function(){reconfigureEditor(cell,$curEditContainer,mode,SELECT_EDIT_MODE)}),!0)},reconfigureEditor=function(cell,$curEditContainer,oldMode,newMode){$curEditContainer.unbind(),$curEditContainer.removeClass("mode-"+oldMode),isEdit[oldMode]=!1,delete $editContainers[oldMode],clearCellNav(),isEdit[SELECT_EDIT_MODE]&&endEdit(!0,SELECT_EDIT_MODE),isEdit[DEFAULT_EDIT_MODE]&&endEdit(!0,DEFAULT_EDIT_MODE),cellNavTo(cell),hideHotExpander(),$curEditContainer.addClass("mode-"+newMode),configureEditor(cell,$curEditContainer,newMode)},configureEditor=function(cell,$curEditContainer,mode){var blistEditor=$curEditContainer.blistEditor();$curEditContainer.bind("edit_end",function(e,isSave,oe){handleEditEnd(e,isSave,oe,mode)}),mode==SELECT_EDIT_MODE&&$curEditContainer.keydown(navKeyDown).keypress(navKeyPress);var $editor=blistEditor.$editor();isEdit[mode]=!0,$editContainers[mode]=$curEditContainer,mode==DEFAULT_EDIT_MODE&&hideActiveCell();var cellLoc=cellXY(cell),resizeEditor=function(){if(cellLoc){var $cell=function(x,y){var row=model.get(y);if(void 0!==row){var physActive=renderedRows[row.id];if(physActive)return $(physActive.row).children().eq(x)}return null}(cellLoc.x,cellLoc.y);$cell&&(blistEditor.adjustSize($cell[0].offsetWidth+1,$cell[0].offsetHeight+1,.8*$scrolls.width(),.8*$scrolls.height()),positionCellOverlay($curEditContainer,$cell))}};blistEditor.initComplete(function(){resizeEditor(),$curEditContainer.bind("resize",function(){resizeEditor()}),$editor.closest(".blist-table-edit-container").removeClass("blist-table-util").addClass("shown"),"expand"!=mode&&blistEditor.focus()})},endEdit=function(isSave,mode){if(mode||(mode=DEFAULT_EDIT_MODE),isEdit[mode]){mode==DEFAULT_EDIT_MODE&&focus(),delete isEdit[mode];var $curEditContainer=$editContainers[mode];if($curEditContainer){var editor=$curEditContainer.blistEditor();editor.finishEdit();var origValue=editor.originalValue,value=editor.currentValue(),row=editor.row,isValid=editor.isValid(),col=$curEditContainer.data("realColumn");delete $editContainers[mode],!isSave||$.compareValues(origValue,value)&&!model.isCellError(row,col)||model.saveRowValue(value,row,col,isValid),_.defer(function(){$curEditContainer.remove()})}}},handleEditEnd=function(event,isSave,origEvent,mode){endEdit(isSave,mode),"keydown"==(origEvent=origEvent||{}).type&&(mode!=DEFAULT_EDIT_MODE||27!=origEvent.keyCode&&113!=origEvent.keyCode?navKeyDown(origEvent):(didNavKeyDown=!0,expandActiveCell())),isEdit[DEFAULT_EDIT_MODE]||"mousedown"==origEvent.type&&!isElementInScrolls(origEvent.target)?cellNav.deactivate():focus()},hideHotExpander=function(){hotExpander&&(hotExpander.style.top="-10000px",hotExpander.style.left="-10000px",hotExpanderVisible=!1)},killHotExpander=function(){hotCellTimer&&(clearTimeout(hotCellTimer),hotCellTimer=null),endEdit(!0,"expand"),hideHotExpander()},expandHotCell=function(){if(!options.noExpand&&hotCellTimer){hotCellTimer=null;var column=getColumn(hotCell),type=column?column.renderType:null;if(!(type&&type.isInlineEdit&&editCell(hotCell,"expand"))){if(hotExpander)hideHotExpander(),$hotExpander=$(hotExpander);else{hotExpander=document.createElement("div");var $hotExpander=$(hotExpander);$hotExpander.addClass("blist-table-expander"),$hotExpander.addClass("blist-table-util")}null!=hotExpander.parentNode&&11!=hotExpander.parentNode.nodeType||$render.append($hotExpander);var $hotCell=$(hotCell),$wrap=$hotCell.clone();$wrap.width("auto").height("auto"),$hotExpander.width("auto").height("auto"),$hotExpander.empty(),$hotExpander.append($wrap);var hotWidth=$hotCell.outerWidth(),hotHeight=$hotCell.outerHeight();if($wrap.outerWidth()<=hotWidth+2&&$wrap.outerHeight()<=hotHeight+2)hideHotExpander();else{var rc=sizeCellOverlay($hotExpander,$wrap,$hotCell,null,!0);rc=$.extend(rc,positionCellOverlay($hotExpander,$hotCell,!0,rc)),$hotExpander.removeClass("blist-table-util"),hotExpanderVisible=!0,$hotExpander.animate(rc,100,null,function(){hotExpanderVisible||hideHotExpander()})}}}},positionCellOverlay=function($container,$refCell,animate,curSize){var maxWidth,maxHeight,$parent=$container.parent(),left=$refCell.offset().left-$parent.offset().left+$parent.scrollLeft(),top=$refCell.offset().top-$parent.offset().top-1+$parent.scrollTop(),origOffset={top:top,left:left},contWidth=curSize?curSize.width:$container.outerWidth(),viewportWidth=$scrolls.width();$scrolls[0].scrollHeight>$scrolls[0].clientHeight&&(viewportWidth-=scrollbarWidth);var scrollLeft=$scrolls.scrollLeft(),refWidth=$refCell.outerWidth();left+contWidth>scrollLeft+viewportWidth&&left+refWidth-scrollLeft>scrollLeft+viewportWidth-left?(maxWidth=left+refWidth-scrollLeft,left-=Math.min(maxWidth,contWidth)-refWidth):maxWidth=scrollLeft+viewportWidth-left;var contHeight=curSize?curSize.height:$container.outerHeight(),viewportHeight=$scrolls.height();$footerScrolls.is(":visible")&&(viewportHeight-=$footerScrolls.outerHeight()-1),$pagination.is(":visible")&&(viewportHeight-=$pagination.outerHeight()-1),$scrolls[0].scrollWidth>$scrolls[0].clientWidth&&(viewportHeight-=scrollbarWidth);var scrollTop=$parent.scrollTop()+($scrolls.offset().top-$parent.offset().top),refHeight=$refCell.outerHeight();return top+contHeight>scrollTop+viewportHeight&&top+refHeight-scrollTop>scrollTop+viewportHeight-top?(maxHeight=top+refHeight-scrollTop,top-=Math.min(maxHeight,contHeight)-refHeight):maxHeight=scrollTop+viewportHeight-top,animate||(origOffset={top:top,left:left}),$container.css("top",origOffset.top+"px"),$container.css("left",origOffset.left+"px"),$container.css("max-width",maxWidth+"px"),$container.css("max-height",maxHeight+"px"),{left:left,top:top}},sizeCellOverlay=function($container,$expandCells,$refCells,$extraItems,animate){$expandCells.eq(0).addClass("blist-first"),$expandCells.eq($expandCells.length-1).addClass("blist-last"),$container.css("max-width","").css("max-height","");var rc={width:$container.outerWidth(),height:$container.outerHeight()},refWidth=0,refHeight=0,minWidths=[];_.each($.makeArray($refCells).concat($.makeArray($extraItems)),function(t){var $t=$(t),w=$t.outerWidth();refWidth+=w,minWidths.push(w),refHeight=Math.max(refHeight,$t.outerHeight())}),refWidth+=1,refHeight+=1,rc.width<refWidth&&(rc.width=refWidth),rc.height<refHeight&&(rc.height=refHeight);var maxWidth=$scrolls.width();$scrolls[0].scrollHeight>$scrolls[0].clientHeight&&(maxWidth-=scrollbarWidth);var scrollsLeft=$scrolls.offset().left;maxWidth=Math.max(maxWidth-($refCells.eq(0).offset().left-scrollsLeft),$refCells.eq(-1).offset().left-scrollsLeft+$refCells.eq(-1).outerWidth(!0)),maxWidth=Math.floor(.8*maxWidth),rc.width>maxWidth&&($container.width(maxWidth),rc.width=maxWidth,rc.height=$container.outerHeight());var maxHeight=$scrolls.height();$scrolls[0].scrollWidth>$scrolls[0].clientWidth&&(maxHeight-=scrollbarWidth);var scrollsTop=$scrolls.offset().top;maxHeight=Math.max(maxHeight-($refCells.eq(0).offset().top-scrollsTop),$refCells.eq(-1).offset().top-scrollsTop+$refCells.eq(-1).outerHeight(!0)),maxHeight=Math.floor(.9*maxHeight),rc.height>maxHeight&&(rc.height=maxHeight);var outerPadx=$container.outerWidth()-$container.width(),outerPady=$container.outerHeight()-$container.height();rc.width-=outerPadx,rc.height-=outerPady;var availW=rc.width;$.isBlank($extraItems)||$extraItems.each(function(){var $t=$(this);availW-=$t.outerWidth()});var countedScroll=!1,extraPadding=0;return $expandCells.each(function(i){var minW=minWidths.shift(),$t=$(this),w=$t.outerWidth(),innerPadx=w-$t.width();if(0==i&&$expandCells.length>1&&(innerPadx+=outerPadx/2),!countedScroll&&$t.outerHeight()>rc.height&&(availW-=scrollbarWidth,countedScroll=!0),w>minW&&(innerPadx--,extraPadding++),$t.width(Math.min(Math.max(minW,w),availW)-innerPadx),availW-=$t.outerWidth(),rc.height>$t.outerHeight()){var innerPady=$t.outerHeight()-$t.height();$t.height(rc.height-innerPady)}}),rc.width+=extraPadding,animate||(refWidth=rc.width,refHeight=rc.height),$container.width(refWidth),$container.height(refHeight),rc},hotHeaderDrag=!1,findContainer=function(event,selector){var $container;try{$container=$("mouseout"==event.type?event.relatedTarget:event.target)}catch(ignore){$container=$(event.target)}return $container&&($container.is(selector)||($container=$container.closest(selector)).length)?$container[0]:null},findCell=function(event){var cell=findContainer(event,".blist-td, .blist-table-expander, .blist-table-active-container, .blist-table-edit-container");if(!cell)return null;var $cell=$(cell);if($cell.is(".blist-tdfill, .blist-opener-space"))return null;if($activeCells&&($activeContainer&&($cell[0]==$activeContainer[0]||$cell.parent()[0]==$activeContainer[0])||$cell.closest(".blist-table-edit-container.mode-"+DEFAULT_EDIT_MODE).length>0||$cell.closest(".blist-table-edit-container.mode-"+SELECT_EDIT_MODE).length>0))return $activeCells[0];if($cell.hasClass("blist-tdh")){for(;!$cell.hasClass("blist-opener");)$cell=$(cell=cell.previousSibling);return cell}return cell==hotExpander||cell.parentNode==hotExpander||$cell.closest(".blist-table-edit-container.mode-expand").length>0?hotCell:cell},handleColumnResize=function(event,isFinished){var width=event.clientX-dragHeaderLeft-paddingX;width<10&&(width=10);var e,col=(e=hotHeader,model.columnForID(e.getAttribute("colId")));col.hasOwnProperty("minWidth")&&width<col.minWidth&&(width=col.minWidth),col.hasOwnProperty("percentWidth")&&(varDenom[0]-=col.percentWidth,delete col.percentWidth,variableColumns[0]=$.grep(variableColumns[0],function(c){return c.id==col.id},!0),col.minWidth&&(varMinWidth[0]-=col.minWidth)),col.update({width:width}),col.view._markTemporary(!col.view.isDefault()||!col.view.isPublished()),adjustHeaderStyling($(col.dom),!0),$this.trigger("column_resized",[col,isFinished]),updateColumnSelection()},makeHotRow=function(rowID){$("#"+id+"-r"+rowID).addClass("blist-hot-row"),$("#"+id+"-l"+rowID).addClass("blist-hot-row"),model.view.highlightRows({id:rowID})},unHotRow=function(rowID){$("#"+id+"-r"+rowID).removeClass("blist-hot-row"),$("#"+id+"-l"+rowID).removeClass("blist-hot-row"),rowID==hotRowID&&(hotRowID=null),model.view.unhighlightRows({id:rowID})},onMouseMove=function(event){if(hotHeaderDrag){if(2==hotHeaderMode)return void handleColumnResize(event);if(4==hotHeaderMode)return}if(mouseDownAt){if((clickTarget&&Math.abs(event.clientX-mouseDownAt.x)>3||Math.abs(event.clientY-mouseDownAt.y>3))&&(clickTarget=null,clickCell=null),selectFrom&&!clickTarget){cellNav.selectionInit(cellXY(selectFrom))||cellNavTo(selectFrom,event);var over=findCell(event);over&&$(over).closest(".blist-table-edit-container").length<=0&&cellNavTo(over,event,!0)}}else if(!function(event){if(4==hotHeaderMode&&hotHeaderDrag||isDisabled)return!1;var container=findContainer(event,".blist-tr, .blist-table-header");if(!container)return!1;var hh,hhm,x=event.clientX,foundRealHeader=!1,$headers=$(".blist-th:not(.blist-table-ghost), .blist-tdh",container);if($headers.each(function(i){var header=$(this),left=header.offset().left;if(left>x)return!1;var right=left+header.outerWidth(),isCtl=header.is(".blist-opener, .blist-table-row-handle, .blist-table-ghost, .blist-column-adder");if(!(isCtl||header.is(".nested_table")||options.disableLastColumnResize&&i==$headers.length-1)&&x>=right-options.resizeHandleAdjust&&x<right+options.resizeHandleAdjust)return hh=header[0],hhm=2,dragHeaderLeft=left,foundRealHeader=header.is(".blist-th, .blist-tr-open .blist-tdh"),!1;if(x>=left&&x<right){hh=header[0];var $dragHandle=header.find(".dragHandle");if($dragHandle.length<1)return!1;var dragLeft=$dragHandle.offset().left,dragRight=dragLeft+$dragHandle.outerWidth();return hhm=x>=dragLeft&&x<dragRight?4:isCtl?3:1,foundRealHeader=header.is(".blist-th, .blist-tr-open .blist-tdh"),!1}}),hh){if(hh!=hotHeader||hhm!=hotHeaderMode){hotHeaderMode=hhm;var $hh=$(hotHeader=hh),isNT=$hh.hasClass("blist-tdh");2==hotHeaderMode?($outside.css("cursor","col-resize"),isNT&&$hh.css("cursor","col-resize")):($outside.css("cursor","default"),isNT&&$hh.css("cursor","default"))}return foundRealHeader}return!1}(event)?hotHeader&&(hotHeader=null,$outside.css("cursor","auto")):hotCell&&onCellOut(event),!((over=findCell(event))==hotCell||$activeCells&&$activeCells.index(over)>=0||$(over).closest(".blist-table-edit-container").length>0)){var $nhr=$(over).closest(".blist-tr"),newHotID=$nhr.length>0?($nhr.attr("id")||"").substring(id.length+2):null;isDisabled||newHotID==hotRowID||(hotRowID&&unHotRow(hotRowID),newHotID&&makeHotRow(newHotID),hotRowID=newHotID),function(newCell,event){hotCell&&onCellOut(event),hotCell=newCell,newCell&&($(newCell).addClass("blist-hot"),options.cellExpandEnabled&&(hotCellTimer=setTimeout(expandHotCell,100)))}(over,event)}},onCellOut=function(event){if(!($(event.relatedTarget).closest(".columnHeaderMenu, .rowMenu").length>0)&&hotCell){var to=findCell(event);if(to==hotCell)return;if(hotRowID){var $nhr=$(to).closest(".blist-tr");($nhr.length>0?$nhr.attr("id").substring(id.length+2):null)!=hotRowID&&unHotRow(hotRowID)}$(hotCell).removeClass("blist-hot"),hotCell=null,killHotExpander()}},onCellClick=function(event,origEvent){var cell=findCell(event);if(cell){var row=getRow(cell);if(!row)return;var column=getColumn(cell),cellEvent=$.Event("cellclick");if($this.trigger(cellEvent,[row,column,origEvent]),cellEvent.isDefaultPrevented())return;var skipSelect=!1;$(cell).hasClass("blist-opener")&&!$(cell).hasClass("blist-opener-inactive")&&(clearCellNav(),endEdit(DEFAULT_EDIT_MODE),model.expand(row),skipSelect=!0),isDisabled||skipSelect||cellNav&&cellNav.isActive()||!options.selectionEnabled||(origEvent.shiftKey?model.selectRowsTo(row):model.selectRow(row),unHotRow(row.id))}},pageSize=1,navigateX=function(deltaX,event,wrap){var to=cellNav.navigateX(deltaX,event,wrap);return to&&cellNavToXY(to,event,!1,wrap),!_.isNull(to)},navigateY=function(deltaY,event,wrap){var to=cellNav.navigateY(Math.floor(deltaY),event,wrap);to&&cellNavToXY(to,event,!1,wrap)},didNavKeyDown=!1,navKeyDown=function(event){didNavKeyDown=!0,doKeyNav(event)},checkForEditorInput=function(){var newValue=$navigator.val();newValue&&editCurrentCell(newValue)},editCurrentCell=function(newValue){var curActiveCell=cellNav.isActive()&&$activeCells?$activeCells[0]:null;curActiveCell&&editCell(curActiveCell,null,newValue)},navKeyPress=function(event){cellNav&&cellNav.isActive()&&($navigator.val(""),setTimeout(checkForEditorInput,1)),didNavKeyDown?didNavKeyDown=!1:doKeyNav(event)},doKeyNav=function(event){var resetFocusToActiveCell=function(){hideActiveCell(),focus(),setTimeout(expandActiveCell,0)};if(cellNav){switch(event.keyCode){case 90:if(!event.metaKey)return;model.canUndo()&&model.undo();break;case 89:if(!event.metaKey)return;model.canRedo()&&model.redo();break;case 33:navigateY(-pageSize,event);break;case 34:navigateY(pageSize,event);break;case 37:navigateX(-1,event);break;case 38:navigateY(-1,event);break;case 39:navigateX(1,event);break;case 40:navigateY(1,event);break;case 8:editCurrentCell("");break;case 9:var direction=event.shiftKey?-1:1;if(event.shiftKey=!1,!navigateX(direction,event,!0))return void resetFocusToActiveCell();break;case 13:!event.shiftKey&&$activeCells&&$activeCells.hasClass("blist-opener")&&!$activeCells.hasClass("blist-opener-inactive")?model.expand(getRow($activeCells[0])):(direction=event.shiftKey?-1:1,event.shiftKey=!1,navigateY(direction,event,!0));break;case 27:clearCellNav();break;case 113:var curActiveCell=$activeCells?$activeCells[0]:null;if(curActiveCell&&editCell(curActiveCell))return void event.preventDefault();break;default:return}resetFocusToActiveCell();try{event.preventDefault()}catch(err){}}},isElementInScrolls=function(element){return $(element).closest(".blist-table-scrolls")[0]==$scrolls[0]};options.simpleCellExpand&&$(".blist-td:not(.blist-td-popout)").live("mouseover",function(){var $td=$(this),innerContentWidth=0;if($td.children().each(function(){innerContentWidth+=$(this).outerWidth(!0)}),!(innerContentWidth<=$td.innerWidth())){var offsetPos=$td.offset();offsetPos.top+=$td.offsetParent().scrollTop();var outTimer,$copy=$td.clone(),clearCopy=function(){$copy.stop().fadeOut("fast",function(){$copy.remove()})};$copy.addClass("blist-td-popout").css("left",offsetPos.left).css("top",offsetPos.top).mouseover(function(){clearTimeout(outTimer)}).mouseleave(clearCopy).fadeIn(),$td.mouseleave(function(){outTimer=setTimeout(clearCopy,0)}),$(document.body).append($copy)}});var headerStr='<label for="blist-table-navigator" class="accessible">hiddenTextField</label><input id="blist-table-navigator" type="text" class="blist-table-navigator hiddenTextField" /><div class="blist-table-locked-scrolls">   <div class="blist-table-locked-header">&nbsp;</div>   <div class="blist-table-locked">     <div class="blist-table-render">&nbsp;</div>   </div>   <div class="blist-table-locked-footer">&nbsp;</div></div><div class="blist-table-top">  <div class="blist-table-header-scrolls">    <div class="blist-table-header">&nbsp;</div>    <div class="indicator-container"></div></div></div><div class="blist-table-scrolls">  <div class="blist-table-inside">    <div class="blist-table-render">&nbsp;</div>    <div class="blist-table-no-results hide">'+$.t("controls.grid.no_rows")+'</div>  </div></div><div class="blist-table-footer-scrolls">    <div class="blist-table-footer">&nbsp;</div></div><div class="blist-table-pagination"></div><div class="blist-table-util"></div>';$(document).mouseup(function(event){if(mouseDownAt=null,!isEdit[DEFAULT_EDIT_MODE]){if(!isDisabled&&hotHeaderDrag)return hotHeaderDrag=!1,2==hotHeaderMode&&handleColumnResize(event,!0),hotHeaderMode>1&&(skipHeaderClick=!0),onMouseMove(event),event.stopPropagation(),event.preventDefault(),!0;var $target=$(event.target);if(!($target.closest(".action-item").length>0||$target.parents().index($outside)<0||$target.hasClass("commentLink")||$target.parent().hasClass("commentLink"))){var cell=findCell(event),editMode=!1;if(!isDisabled&&cellNav&&null!==cell&&cell==clickCell){var curActiveCell=cellNav.isActive()&&$activeCells?$activeCells[0]:null;curActiveCell&&$prevActiveCells&&$prevActiveCells.index(curActiveCell)>=0?editMode=editCell(curActiveCell):curActiveCell&&($prevActiveCells=$activeCells),editMode||focus()}clickTarget&&clickTarget==event.target&&!$(clickTarget).is("a")&&$(clickTarget).trigger("table_click",event),isDisabled||!cellNav||editMode||expandActiveCell()}}});var $outside=$this.addClass("blist-table").bind("mousedown.table",function(event){if(clickTarget=event.target,!isDisabled){clickCell=findCell(event);var $clickTarget=$(clickTarget);if(!$clickTarget.hasClass("commentLink")&&!$clickTarget.parent().hasClass("commentLink")&&!($clickTarget.is(".blist-table-scrolls, .blist-table-expander")||isEdit[DEFAULT_EDIT_MODE]&&$clickTarget.parents().andSelf().index($editContainers[DEFAULT_EDIT_MODE])>=0)){if(mouseDownAt={x:event.clientX,y:event.clientY},hotHeader&&3!=hotHeaderMode)return $clickTarget.closest(".action-item").length<1&&($clickTarget.closest(".blist-tdh").length<1||2==hotHeaderMode)&&(clickTarget=null,clickCell=null,hotHeaderDrag=!0,4!=hotHeaderMode&&event.stopPropagation(),event.preventDefault()),isEdit[DEFAULT_EDIT_MODE]&&endEdit(!0),cellNav&&(cellNav.deactivate(),hideActiveCell()),void($clickTarget.closest(".action-item").length<1&&event.preventDefault());if(selectFrom=null,clickedInGrid=isElementInScrolls(clickTarget),cellNav){var cell=findCell(event);if($(cell).is(".blist-opener, .blist-tdh, .blist-table-row-handle, .blist-column-adder"))return;cell&&$activeCells&&$activeCells.index(cell)>=0?$prevActiveCells=$activeCells:($prevActiveCells=null,event.shiftKey||event.metaKey||clearCellNav()),cell&&cellNavTo(cell,event)&&(isEdit[DEFAULT_EDIT_MODE]&&endEdit(!0),selectFrom=cell)}}}}).bind("mousemove.table",onMouseMove).bind("dblclick.table",function(event){if(!isDisabled&&!(isEdit[DEFAULT_EDIT_MODE]&&$(event.target).parents().andSelf().index($editContainers[DEFAULT_EDIT_MODE])>=0)&&(clickTarget=event.target,cellNav)){var cell=findCell(event);cell&&editCell(cell)}}).html(headerStr);options.columnDrag&&($outside.append($('<div class="dropIndicator"/>')),$dropIndicator=$(".dropIndicator",$outside).css("left",-1e4).hide());var $lockedScrolls=$outside.find(".blist-table-locked-scrolls"),$lockedHeader=$lockedScrolls.find(".blist-table-locked-header"),$locked=$lockedScrolls.find(".blist-table-locked").bind("table_click",onCellClick),$lockedRender=$locked.find(".blist-table-render"),$lockedFooter=$lockedScrolls.find(".blist-table-locked-footer"),$top=$outside.find(".blist-table-top"),$headerScrolls=$top.find(".blist-table-header-scrolls"),$header=$headerScrolls.find(".blist-table-header"),$scrolls=$outside.find(".blist-table-scrolls").scroll(_.throttle(function(){onScroll(),renderRows()},50)).bind("touchstart",function(event){var e=event.originalEvent;touchLastY=e.targetTouches[0].clientY,touchLastX=e.targetTouches[0].clientX}).bind("touchmove",function(event){var e=event.originalEvent;if(_.isUndefined(e.targetTouches)||1!==e.targetTouches.length)return!1;var $outsideScrolls=$outside.find(".blist-table-scrolls"),deltaY=touchLastY-e.targetTouches[0].clientY;deltaY/=2,$outsideScrolls[0].scrollTop=$outsideScrolls[0].scrollTop+deltaY;var deltaX=touchLastX-e.targetTouches[0].clientX;$outsideScrolls[0].scrollLeft=$outsideScrolls[0].scrollLeft+deltaX}),inside=$scrolls.find(".blist-table-inside").mouseout(onCellOut).bind("table_click",onCellClick),$render=inside.find(".blist-table-render"),renderDOM=$render[0],$noResults=inside.find(".blist-table-no-results"),scalingFactor=1,renderScaling=1,$footerScrolls=$outside.find(".blist-table-footer-scrolls"),$footer=$footerScrolls.find(".blist-table-footer"),$pagination=$outside.find(".blist-table-pagination"),appendUtilDOM=$(document.createElement("div"))[0],measureUtil=$outside.find(".blist-table-util"),measureUtilDOM=measureUtil[0],$navigator=$outside.find(".blist-table-navigator").keydown(navKeyDown).keypress(navKeyPress).bind("copy",function(){cellNav&&($navigator.val(cellNav.getSelectionDoc()),$navigator[0].select())});$locked.css("top",$header.outerHeight());var clickedInGrid=!1;if(cellNav){$(document).mousedown(function(e){!cellNav.isActive()||clickedInGrid||isElementInScrolls(e.target)||(cellNav.deactivate(),hideActiveCell()),clickedInGrid=!1})}var scrollbarWidth=function(){var div=$('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div></div>');$("body").append(div);var w1=div[0].clientWidth;div.css("overflow","scroll");var w2=div[0].clientWidth;return $(div).remove(),w1-w2}(),updateLayout=function(){if(dsReady&&!(rowOffset<1)&&(begin("updateLayout.size.header"),$headerScrolls.height($header.outerHeight()),end("updateLayout.size.header"),begin("updateLayout.size.scrolls"),$scrolls.height($outside.height()-$top.outerHeight()-($scrolls.outerHeight()-$scrolls.height())-1),$scrolls.width($outside.width()-($scrolls.outerWidth()-$scrolls.width())),end("updateLayout.size.scrolls"),!($scrolls.height()<5))){begin("updateLayout.size.calculate");var scrollHeight=$scrolls[0].clientHeight;pageSize=scrollHeight/rowOffset||1;var rowCount=void 0!==model?model.length():0,insideHeight=rowOffset*rowCount;end("updateLayout.size.calculate"),begin("updateLayout.size.footer");var footerHeight=0;$footerScrolls.is(":visible")&&(footerHeight+=$footerScrolls.outerHeight()-1),$pagination.is(":visible")&&(footerHeight+=$pagination.outerHeight()-1),insideHeight+footerHeight<scrollHeight&&(footerHeight+=scrollHeight-footerHeight-insideHeight),end("updateLayout.size.footer"),begin("updateLayout.size.scale");var origHeight=insideHeight;for(insideHeight/=scalingFactor,inside.height(insideHeight+footerHeight);inside.height()<insideHeight+footerHeight-2;)insideHeight=origHeight/++scalingFactor,inside.height(insideHeight+footerHeight);var lastPageHeight=scrollHeight-footerHeight;if(renderScaling=(insideHeight-lastPageHeight)/(rowCount-(lastPageHeight/rowOffset||1))||1,$locked.height(insideHeight+footerHeight),$render.position().top+$render.height()>insideHeight+footerHeight){var adjTop=insideHeight+footerHeight-$render.height();$render.css("top",adjTop),$lockedRender.css("top",adjTop)}end("updateLayout.size.scale"),begin("updateLayout.size.scrollUpdate"),$scrolls.scroll(),end("updateLayout.size.scrollUpdate"),begin("updateLayout.renderRows"),end("updateLayout.renderRows"),begin("updateLayout.configWidths"),configureWidths(),end("updateLayout.configWidths"),begin("updateLayout.footer");var lockedBottom=parseFloat($scrolls.css("border-bottom-width"))+1,footerBottom=parseFloat($scrolls.css("border-bottom-width"))+$footerScrolls.outerHeight();$scrolls[0].scrollWidth>$scrolls[0].clientWidth&&(lockedBottom+=scrollbarWidth,footerBottom+=scrollbarWidth);var paginationHeight=$pagination.filter(":visible").outerHeight()||0;$lockedFooter.css("bottom",paginationHeight-2),$lockedScrolls.height($outside.height()-lockedBottom),$footerScrolls.css("bottom",footerBottom+paginationHeight-2),$pagination.css("bottom",scrollbarWidth),scrollbarWidth>0&&$pagination.css("width","calc(100% - {0}px)".format(scrollbarWidth));var marginR=$scrolls.outerHeight()-$scrolls.height();$scrolls[0].scrollHeight>$scrolls[0].clientHeight&&(marginR+=scrollbarWidth),$footerScrolls.css("margin-right",marginR),end("updateLayout.footer")}};options.manualResize?$this.bind("resize.table",updateLayout):$(window).resize(updateLayout);var ghostClass,openerClass,headerScrolledTo=0,rowsScrolledTo=0,onScroll=function(){begin("onScroll"),$(document).trigger("click");var scrollHoriz=$scrolls[0].scrollLeft,horizontalChange=!1;scrollHoriz!=headerScrolledTo&&($header[0].style.left=-scrollHoriz+"px",$footer[0].style.left=-scrollHoriz+"px",headerScrolledTo=scrollHoriz,horizontalChange=!0);var doVertScroll=function(){var scrollVert=$scrolls[0].scrollTop;if(scrollVert!=rowsScrolledTo){var scrollDiff=scrollVert-rowsScrolledTo,absDiff=Math.abs(scrollDiff);if(absDiff<75&&absDiff/renderScaling>.8*pageSize){var adjDiff=Math.ceil(.5*pageSize*renderScaling)*(scrollDiff<0?-1:1);scrollVert=rowsScrolledTo+adjDiff,$scrolls[0].scrollTop=scrollVert}$locked.css("top",$header.outerHeight()-scrollVert),rowsScrolledTo=scrollVert}};horizontalChange?setTimeout(doVertScroll,50):doVertScroll(),end("onScroll")},sheetName=id+"_blistTable",addStyle=function(name,selector){blist.styles.addStyle(sheetName,name,selector)},style=function(name){return blist.styles.getStyle(sheetName,name)},getColumnClass=function(column){return id+"-c"+column.id},getColumnStyle=function(column){var result=style("column-"+column.id);if(!result)throw"Uninitialized column style access for "+column.id;return result},addColumnStyle=function(column){addStyle("column-"+column.id,"."+getColumnClass(column))};openerClass=id+"-opener",addStyle("ghostStyle","."+(ghostClass=id+"-ghost")),addStyle("openerStyle","div."+openerClass),addStyle("rowStyle","#"+id+" .blist-tr"),addStyle("unlockedRowStyle","#"+id+" .blist-table-inside .blist-tr"),addStyle("cellStyle","#"+id+" .blist-cell"),addStyle("groupHeaderStyle","#"+id+" .blist-td-header");var rowRenderFn,rowLockedRenderFn,rowHeight,rowOffset,handleDigits,paddingX,lockedWidth,openerWidth,insideWidth,rowNumberColumn,rowHandleColumn,$dropIndicator,pendingTop,prevTop,setTop,curView,columns=[],lockedColumns=[],variableColumns=[],layout=[],handleWidth=0,adderWidth=0,varMinWidth=[],varDenom=[],customCellClasses={},renderCell=function renderCell(html,index,renderIndex,row,col,colIndex,level,contextVariables){var children,child;if($.isBlank(col.visibleChildColumns)||0!=level)if($.isBlank(col.visibleChildColumns))if("fill"==col.renderTypeName)html.push('<div class="blist-td blist-tdfill ',getColumnClass(col),0==colIndex?" initial-tdfill":"",'">&nbsp;</div>');else{var type=col.renderType,cls=col.cls||type.cls;cls=cls?" blist-td-"+cls:"";var curRow=row;$.isBlank(col.parentColumn)||(curRow=row.data[col.parentColumn.lookup]);var renderType=curRow.invalid[col.lookup]?blist.datatypes.invalid:type;html.push('<div class="blist-td ',getColumnClass(col),cls,col.format.drill_down?" drill-td":"",col.format.align?" align-"+col.format.align:"",curRow.invalid[col.lookup]?" invalid":"",curRow.changed&&curRow.changed[col.lookup]?" saving":"",curRow.error&&curRow.error[col.lookup]?" error":"",curRow.sessionMeta&&curRow.sessionMeta.highlightColumn==col.id?" blist-td-highlight":""),$.isBlank(col.parentColumn)&&html.push(" ",((contextVariables.cellClasses[row.id]||{})[col.lookup]||[]).join(" ")),html.push('">'),html.push(renderType.renderer(curRow.data[col.lookup],col,!1,!1,contextVariables)),$.isBlank(col.parentColumn)&&!$.isBlank((curRow.annotations||{})[col.lookup])&&html.push('<span class="annotation ',curRow.annotations[col.lookup],'"></span>'),html.push("</div>")}else{var j;if(children=col.visibleChildColumns,$.isBlank(row.data[col.lookup])){for(html.push('<div class="blist-td blist-opener-space ',"blist-tdfill ",openerClass,'"></div>'),options.showRowHandle&&html.push('<div class="blist-td blist-tdfill ',getColumnClass(rowHandleColumn),' blist-table-row-handle"></div>'),j=0;j<children.length;j++)html.push('<div class="blist-td blist-tdfill blist-td-colfill ',getColumnClass(children[j]),'"></div>');options.showAddColumns&&html.push('<div class="blist-td blist-column-adder-space blist-column-adder ','blist-tdfill"></div>')}else{for(html.push('<div class="blist-td blist-opener-space ',openerClass,'"></div>'),options.showRowHandle&&(html.push('<div class="blist-td ',getColumnClass(rowHandleColumn),' blist-table-row-handle">'),options.rowHandleRenderer(html,index,renderIndex,row,col,contextVariables),html.push("</div>")),j=0;j<children.length;j++)renderCell(html,index,renderIndex,row,children[j],j,level,contextVariables);options.showAddColumns&&html.push('<div class="blist-td ','blist-column-adder-space blist-column-adder">',"</div>")}}else if(children=col.visibleChildColumns,!_.isEmpty(row.data[col.lookup])||model.useBlankRows()){html.push('<div class="',getColumnClass(col)," blist-td blist-tdh blist-opener ",openerClass,'"></div>'),options.showRowHandle&&html.push('<div class="',getColumnClass(rowHandleColumn),' blist-td blist-tdh blist-table-row-handle">',"</div>");for(var k=0;k<children.length;k++)child=children[k],html.push('<div class="blist-td blist-tdh ',getColumnClass(child)," ",child.renderTypeName,'" parentColId="',child.parentColumn.id,'" colId="',child.id,'">',canEdit()?'<div class="blist-th-icon"></div>':"",'<a class="menuLink action-item" href="#column-menu"></a>','<div class="button-wrapper"> <div class="info-button action-item"></div> </div>','<span class="info-container">','<div class="name-wrapper">','<span class="blist-th-name">',htmlEscape(child.name),"</span></div></span></div>");options.showAddColumns&&html.push('<div class="',getColumnClass(col),' blist-td blist-tdh blist-column-adder">','<div class="blist-column-adder-icon" ','title="'+$.t("controls.grid.add_column")+'"></div></div>')}else{for(html.push('<div class="',getColumnClass(col)," blist-td blist-tdh blist-opener blist-opener-inactive ",openerClass,'"></div>'),options.showRowHandle&&html.push('<div class="',getColumnClass(rowHandleColumn),' blist-td blist-tdh blist-table-row-handle handle-inactive"></div>'),k=0;k<children.length;k++)child=children[k],html.push('<div class="blist-td blist-tdh ',getColumnClass(child),'" parentColId="',child.parentColumn.id,'" colId="',child.id,'"></div>');options.showAddColumns&&html.push('<div class="',getColumnClass(col),' blist-td blist-tdh blist-column-adder">','<div class="blist-column-adder-icon" ','title="'+$.t("controls.grid.add_column")+'"></div></div>')}},processLogicalColumns=function processLogicalColumns(mcols,lcols,level){for(var j=0;j<mcols.length;j++){var mcol=mcols[j];if($.isBlank(mcol.visibleChildColumns)||0!=level)$.isBlank(mcol.visibleChildColumns)?"fill"==mcol.renderTypeName?lcols.push({renderTypeName:"fill",canFocus:!1,mcol:mcol}):lcols.push({mcol:mcol,logical:mcol.id}):(lcols.push({renderTypeName:"nest-header",canFocus:!1,skippable:!0,skipCount:mcol.visibleChildColumns.length,mcol:mcol,logical:mcol.id}),options.showRowHandle&&lcols.push({renderTypeName:"nest-header",canFocus:!1,skippable:!0,mcol:mcol,logical:mcol.id}),processLogicalColumns(mcol.visibleChildColumns,lcols,level),options.showAddColumns&&lcols.push({renderTypeName:"nest-header",canFocus:!1,skippable:!0,mcol:mcol,logical:mcol.id}));else{lcols.push({renderTypeName:"opener",skippable:!0,skipCount:mcol.visibleChildColumns.length,mcol:mcol,logical:mcol.id}),options.showRowHandle&&lcols.push({renderTypeName:"handle",canFocus:!1,mcol:mcol,logical:mcol.id});for(var k=0;k<mcol.visibleChildColumns.length;k++)lcols.push({renderTypeName:"header",canFocus:!1,mcol:mcol.visibleChildColumns[k],logical:mcol.id});options.showAddColumns&&lcols.push({renderTypeName:"adder",canFocus:!1,mcol:mcol,logical:mcol.id})}options.generateHeights&&(getColumnStyle(mcol).height=rowHeight+"px")}},initMeta=function(){begin("initMeta"),clearCellNav(),endEdit(DEFAULT_EDIT_MODE),columns=[],variableColumns=[],varMinWidth=[],varDenom=[];for(var j=0;j<model.columns().length;j++){variableColumns[j]=[],varMinWidth[j]=0,varDenom[j]=0;for(var cols=model.columns()[j],i=0;i<cols.length;i++){var col=cols[i];col.hasOwnProperty("percentWidth")&&(varDenom[j]+=col.percentWidth,col.minWidth&&(varMinWidth[j]+=col.minWidth),col.width=0,variableColumns[j].push(col)),0==j&&columns.push(col),addColumnStyle(col),$.isBlank(col.visibleChildColumns)||_.each(col.visibleChildColumns,function(c){addColumnStyle(c)})}}variableColumns[0].length<1&&options.showGhostColumn?(variableColumns[0].push({percentWidth:100,minWidth:options.ghostMinWidth,ghostColumn:!0}),varMinWidth[0]+=options.ghostMinWidth,varDenom[0]+=100):options.showGhostColumn=!1,lockedColumns=[],options.showRowNumbers&&(lockedColumns.push(rowNumberColumn={id:"rowNumberCol",cls:"blist-table-row-numbers",measureText:Math.max(model.length(),100),renderer:function(html,index,renderIndex,row){"blank"==row.type?html.push($.t("controls.grid.new_row")):row.noMatch?html.push('<span title="'+$.t("controls.grid.row_does_not_match")+'">X</span>'):html.push('<a href="',model.view.url,"/",row.id,'" ','title="'+$.t("controls.grid.view_row")+'" class="noInterstitial noRedirPrompt">',renderIndex+1,"</a>")},footerText:$.t("controls.grid.totals")}),addColumnStyle(rowNumberColumn)),options.showRowHandle&&(lockedColumns.push(rowHandleColumn={id:"rowHandleCol",cls:"blist-table-row-handle",width:options.rowHandleWidth,renderer:options.rowHandleRenderer}),addColumnStyle(rowHandleColumn)),handleDigits=calculateHandleDigits(),measureUtilDOM.innerHTML='<div class="blist-td">x</div>';var $measureDiv=$(measureUtilDOM.firstChild),measuredInnerDims={width:Math.max(0,Math.floor($measureDiv.width())),height:Math.max(0,$measureDiv.height())},measuredOuterDims={width:$measureDiv.outerWidth(),height:$measureDiv.outerHeight()};paddingX=measuredOuterDims.width-measuredInnerDims.width,rowHeight=measuredInnerDims.height,(rowOffset=measuredOuterDims.height)>0&&(style("rowStyle").height=rowOffset+"px"),scalingFactor=1,options.generateHeights&&options.showGhostColumn&&(style("ghostStyle").height=rowHeight+"px"),options.generateHeights&&(style("cellStyle").height=rowHeight+"px"),lockedWidth=0,_.each(lockedColumns,function(c){measureUtilDOM.innerHTML='<div class="blist-tr"><div class="'+(c.width?getColumnClass(c):"")+" "+(c.cls||"")+' blist-td">'+(c.measureText||"")+"</div></div>";var $measureCol=$(measureUtilDOM).find(".blist-td"),colStyle=getColumnStyle(c);if(c.width)colStyle.width=c.width+"px";else{var w=Math.floor($measureCol.width());w>=0&&(colStyle.width=w+"px")}lockedWidth+=$measureCol.outerWidth(),options.generateHeights&&(colStyle.height=rowHeight+"px")}),openerWidth=1.5*measuredInnerDims.width,options.showAddColumns&&(measureUtilDOM.innerHTML='<div class="blist-td blist-column-adder">x</div>',$measureDiv=$(measureUtilDOM.firstChild),adderWidth=Math.floor($measureDiv.width())+paddingX),options.showRowHandle&&(handleWidth=parseFloat(getColumnStyle(rowHandleColumn).width)+paddingX),style("openerStyle").width=openerWidth+"px",options.generateHeights&&(style("openerStyle").height=rowHeight+"px");var contextVariables={permissions:{canRead:model.canRead(),canWrite:model.canWrite(),canAdd:model.canAdd(),canDelete:model.canDelete(),canEdit:canEdit()},cellClasses:customCellClasses,modelView:model.view};for(i=0;i<model.columns().length;i++){var modelColumns=model.columns()[i],layoutColumns=layout[i]=[];processLogicalColumns(modelColumns,layoutColumns,i)}cellNav?(cellNav.updateModel(model),cellNav.updateLayout(layout)):cellNav=options.cellNav?new blist.data.TableNavigation(model,layout,$navigator):null;var rowDivContents=function(html,index,renderIndex,row){var sanitizedColor=$.sanitizeColor(row.color);html.push('class="blist-tr',renderIndex%2?" blist-tr-even":"",row.noMatch?" blist-tr-noMatch":"",$.isBlank(row.level)?"":" blist-tr-level"+row.level,row.level>0?" blist-tr-sub":"",row.type?" blist-tr-"+row.type:"",row.expanded?" blist-tr-open":"",row.pending?" blist-tr-pending":"",row.sessionMeta&&row.sessionMeta.highlight?" blist-tr-highlight":"",row.groupLast?" last":"",'" style="top:',index*rowOffset,"px",sanitizedColor?";background-color:"+sanitizedColor:"",';"')};rowRenderFn=function(html,index,renderIndex,row){html.push('<div id="',id,"-r",row.id,'"'),rowDivContents(html,index,renderIndex,row),html.push(">");var level=row.level||0;if(level<model.columns().length){var mcols=model.columns()[level];for(i=0;i<mcols.length;i++)renderCell(html,index,renderIndex,row,mcols[i],i,level,contextVariables)}options.showGhostColumn&&html.push('<div class="blist-td ',ghostClass,' blist-table-ghost"></div>'),html.push("</div>")},rowLockedRenderFn=function(html,index,renderIndex,row){for(html.push('<div id="',id,"-l",row.id||row[0],'" '),rowDivContents(html,index,renderIndex,row),html.push(">"),i=0;i<lockedColumns.length;i++){var c=lockedColumns[i];html.push('<div class="',c.cls||""," blist-td ",getColumnClass(c),'">'),c.renderer(html,index,renderIndex,row,null,contextVariables),html.push("</div>")}html.push("</div>")},style("groupHeaderStyle").left=lockedWidth+"px",style("unlockedRowStyle").left=lockedWidth+"px",$headerScrolls.css("margin-left",lockedWidth),$footerScrolls.css("margin-left",lockedWidth),end("initMeta"),configureWidths()},configureWidths=function(){begin("configureWidths"),begin("configureWidths.levels"),insideWidth=0;for(var mcols=model.columns(),i=0;i<mcols.length;i++)configureLevelWidths(mcols[i],i);end("configureWidths.levels"),style("groupHeaderStyle").width=Math.max(0,insideWidth-lockedWidth-paddingX)+"px";var scrollWidth=$scrolls.width();$scrolls[0].scrollHeight>$scrolls[0].clientHeight&&(scrollWidth-=scrollbarWidth);var totalWidth=Math.max(insideWidth,scrollWidth);$header.width(totalWidth),$footer.width(totalWidth),inside.width(totalWidth),$lockedScrolls.width(lockedWidth),$locked.width(lockedWidth),end("configureWidths")},configureLevelWidths=function configureLevelWidths(mcols,level){var columnStyle,hpos=lockedWidth;0==level&&options.showGhostColumn&&(hpos+=paddingX);for(var j=0;j<mcols.length;j++){var colWidth,mcol=mcols[j];if($.isBlank(mcol.visibleChildColumns))if(mcol.fillFor)for(colWidth=0,k=0;k<mcol.fillFor.length;k++){var fillFor=mcol.fillFor[k];colWidth+=(fillFor.width||parseFloat(getColumnStyle(fillFor).width))+paddingX}else colWidth=(mcol.width||0)+paddingX;else if(0==level){colWidth=openerWidth+paddingX,colWidth+=handleWidth,colWidth+=adderWidth;for(var children=mcol.visibleChildColumns,k=0;k<children.length;k++)colWidth+=children[k].width+paddingX}else colWidth=null,configureLevelWidths(mcol.visibleChildColumns,level);if(colWidth){hpos+=colWidth;try{columnStyle=getColumnStyle(mcol)}catch(e){continue}var widthStyle=colWidth-paddingX+"px";columnStyle.width!=widthStyle&&(columnStyle.width=widthStyle)}}hpos+=varMinWidth[level],configureVariableWidths(level,hpos),hpos>insideWidth&&(insideWidth=hpos)},configureVariableWidths=function(level,levelWidth){if(variableColumns[level]instanceof Array&&variableColumns[level].length>0){var pos=levelWidth,varSize=$scrolls.width()-pos;for($scrolls[0].scrollHeight>$scrolls[0].clientHeight&&(varSize-=scrollbarWidth),varSize=Math.max(varSize,0),i=0;i<variableColumns[level].length;i++){var c=variableColumns[level][i];c.ghostColumn?style("ghostStyle").width=c.minWidth+varSize+"px":getColumnStyle(c).width=(c.minWidth||0)+c.percentWidth/varDenom[level]*varSize+"px"}if(0==level&&!options.showGhostColumn){pos=lockedWidth;for(var i=0;i<columns.length;i++){var col=columns[i];col.left=pos,pos+=paddingX,pos+=col.width||parseFloat(getColumnStyle(col).width)}}}},columnHeaderClick=function(event,$target){if(!isDisabled){var col=$target.closest(".blist-th").data("column");if(!$.isBlank(col))return $(event.currentTarget).removeClass("hover").data("column-clicked",!1),$target.closest(".filter").length>0?(clearCellNav(),void $this.trigger("clear_filter",[col])):($target.closest(".sort").length>0||!event.metaKey&&!event.shiftKey)&&(void 0!==col.renderType&&col.renderType.sortable||col.sortable)?(clearCellNav(),void function(col){begin("sort.configure");var sortAscending=!0;$.isBlank(col.sortAscending)||(sortAscending=!col.sortAscending),end("sort.configure"),begin("sort.sort"),$this.trigger("column_sort",[col,sortAscending]),end("sort.sort")}(col)):void(event.metaKey?selectColumn(col,!cellNav.isColumnSelected(col)):event.shiftKey?function(column){if(cellNav)if(null!==cellNav.lastSelectedColumn){var inSelect=!1,lastCol=cellNav.lastSelectedColumn.id;_.each(columns,function(c){if((c.id==column.id||c.id==lastCol)&&!(inSelect=!inSelect))return!1;inSelect&&cellNav.setColumnSelection(c,!0)}),selectColumn(column,!0)}else selectColumn(column,!0)}(col):clearCellNav())}},renderHeader=function(){begin("renderHeader-assemble");for(var html=[],i=0;i<columns.length;i++){var col=columns[i],cls=col.cls?" blist-th-"+col.cls:"",colName=null==col.name?"":htmlEscape(col.name);html.push('<div class="blist-th ',i?"":"blist-th-first ",col.dataTypeName||col.renderTypeName," ",getColumnClass(col),cls,'" colId="',col.id,'">'),"nested_table"==col.renderTypeName&&html.push('<div class="blist-tdh blist-opener ',openerClass,'"></div>'),options.columnDrag&&html.push('<div class="dragHandle"',options.generateHeights?' style="height: '+rowOffset+'px"':"","></div>"),html.push(' <a class="menuLink action-item" href="#column-menu"><span class="link-text">'+$.t("controls.grid.menu")+"</span></a>",'<div class="button-wrapper"> <div class="info-button action-item"></div> </div>','<span class="info-container',canEdit()?" icon-display":"",'">'),canEdit()&&html.push('<span class="blist-th-icon"></span>'),html.push('<div class="name-wrapper"><span class="blist-th-name">',colName,"</span></div>","</span>",'<div class="indicator-container">','<div class="filter" title="'+$.t("controls.filter.actions.remove_filter")+'"',options.generateHeights?' style="height: '+rowOffset+'px"':"","></div>",'<div class="sort sort-desc" title="'+$.t("controls.grid.sort_ascending")+'"',options.generateHeights?' style="height: '+rowOffset+'px"':"","></div>","</div>","</div>")}options.showGhostColumn&&html.push('<div class="blist-th blist-table-ghost ',columns.length<1?"blist-th-first ":"",ghostClass,'">'+(options.showAddColumns?'<div class="blist-column-adder add-column" title="'+$.t("controls.grid.add_column")+'"></div>':"")+'<div class="indicator-container"></div></div>'),html=html.join(""),end("renderHeader-assemble"),begin("renderHeader-render"),$header.trigger("rerender"),$header[0].innerHTML=html,end("renderHeader-render"),begin("renderHeader-augment"),$(".blist-th",$header).each(function(index){if(!(index>=columns.length)){columns[index].dom=this;var $col=$(this),interactionsInitialized=!1;$col.data("column",columns[index]).mouseenter(function(){interactionsInitialized||(interactionsInitialized=!0,$col.mouseleave(function(){$(this).removeClass("hover")}).bind("click",function(event){if(!isDisabled)if(skipHeaderClick)skipHeaderClick=!1;else{var $target=$(event.target);$target.closest(".action-item").length>0||($target.closest(".blist-th .indicator-container, .blist-th .dragHandle, .blist-th .action-item").length<1?$col.data("column-clicked")||($col.data("column-clicked",!0),setTimeout(function(){$col.data("column-clicked")&&columnHeaderClick(event,$target)},500)):columnHeaderClick(event,$target))}}).bind("dblclick",function(event){$(event.target).closest(".blist-th .indicator-container, .blist-th .dragHandle, .blist-th .action-item").length<1&&($col.data("column-clicked",!1),$this.trigger("column_name_dblclick",[event]))}),options.columnDrag&&$col.draggable({appendTo:".blist-table",axis:"x",drag:function(event){var dragPos=findHeaderDragPosition(event);curDropPos!=dragPos&&drawHeaderDragPosition(curDropPos=dragPos)},handle:".dragHandle",helper:function(){var $drag=$('<div class="blist-th-drag"/>');return $drag.append($(this).clone()),$drag},opacity:.85,start:function(){hotHeaderDrag=!0,hotHeaderMode=4},stop:function(){hotHeaderMode=null,$dropIndicator.css("left",-1e4).hide(),null!=curDropPos&&($this.trigger("column_moved",[$(this).data("column"),curDropPos]),curDropPos=null)}}),null!=options.headerMods&&options.headerMods(columns[index])),isDisabled||hotHeaderDrag&&4==hotHeaderMode||$(this).addClass("hover")}),adjustHeaderStyling($col)}});var lockedHtml="";$.each(lockedColumns,function(index,c){lockedHtml+='<div class="blist-th '+(c.cls||"")+" "+getColumnClass(c)+'"><div class="indicator-container"></div></div>'}),$lockedHeader.html(lockedHtml),adjustHeaderIndicators(),end("renderHeader-augment")},adjustHeaderIndicators=function(){!function(){$(".sort.active",$header).removeClass("sort-asc").addClass("sort-desc").attr("title",$.t("controls.grid.sort_ascending")).removeClass("active").closest(".blist-th").removeClass("sorted");for(var i=0;i<columns.length;i++){var col=columns[i];if(col.dom&&!$.isBlank(col.sortAscending)){var sortDescending=!col.sortAscending,oldClass="sort-"+(sortDescending?"asc":"desc"),newClass="sort-"+(sortDescending?"desc":"asc"),newTitle=$.t("controls.grid.sort_"+(sortDescending?"ascending":"descending"));$(".sort",col.dom).removeClass(oldClass).addClass(newClass).attr("title",newTitle).addClass("active").closest(".blist-th").addClass("sorted")}}}(),$(".filter.active",$header).removeClass("active").closest(".blist-th").removeClass("filtered"),_.each(columns,function(c){$.isBlank(c.currentFilter)||$(".filter",c.dom).addClass("active").closest(".blist-th").addClass("filtered")}),$outside.toggleClass("indicators-inactive",((model.view.metadata.jsonQuery||{}).order||[]).length<=0&&_.all(columns,function(c){return $.isBlank(c.currentFilter)})),$locked.css("top",$header.outerHeight()-$scrolls[0].scrollTop)},adjustHeaderStyling=function($colHeader,tertiary){var $orig=$colHeader;tertiary&&($colHeader=$orig.clone(),measureUtil.append($colHeader),$colHeader.removeClass("narrow narrower"));var $infoC=$colHeader.find(".info-container"),infoW=$infoC.outerWidth(!0)+2*$orig.find(".info-button").outerWidth(!1),innerW=$colHeader.width();if(infoW+20>innerW)if((infoW+=parseInt($infoC.css("left")))>innerW){var iconW=$colHeader.find(".blist-th-icon").outerWidth(!0)||0;$orig.toggleClass("narrower",infoW-iconW>innerW),$orig.addClass("narrow")}else tertiary&&$orig.removeClass("narrow narrower");else tertiary&&$orig.removeClass("narrow narrower");tertiary&&$colHeader.remove()},curDropPos=null,findHeaderDragPosition=function(event){var x=event.originalEvent.pageX,$headers=$(".blist-th:not(.ui-draggable-dragging, .blist-table-ghost)",$header);if(x<$headers.eq(0).offset().left)return 0;var dropPos,$lastHeader=$headers.eq($headers.length-1);return x>$lastHeader.offset().left+$lastHeader.outerWidth()?$headers.length:($headers.each(function(i){var $col=$(this),left=$col.offset().left;if(x<left)return!0;var width=$col.outerWidth();return x>left+width||(dropPos=x-left<width/2?i:i+1,!1)}),dropPos)},drawHeaderDragPosition=function(pos){var x,$headers=$(".blist-th:not(.ui-draggable-dragging, .blist-table-ghost)",$header);if(pos>=$headers.length){var $lh=$headers.eq($headers.length-1);x=$lh.offset().left+$lh.outerWidth()}else x=$headers.eq(pos).offset().left;x+=lockedWidth-$headerScrolls.offset().left-$dropIndicator.width()/2,$dropIndicator.css("left",x).show()},updateHeader=function(){begin("updateHeader"),adjustHeaderIndicators(),end("updateHeader")},pendingAggs=!1,renderFooter=function(){if(!pendingAggs){var gotAggs=function(){for(var html=[],showAgg=!1,renderColFooter=function(column){var cls=column.cls?" blist-tf-"+column.cls:"",agg=column.aggregates[column.format.aggregate];showAgg=showAgg||!$.isBlank(agg);var val=agg;if(!$.isBlank(agg)&&_.include(["sum","average","maximum","minimum"],column.format.aggregate)){var c=column;"average"==column.format.aggregate&&(c=$.extend(!0,{format:{precision:3}},column)),val=column.renderType.renderer(agg,c)}html.push('<div class="blist-tf ',i?"":"blist-tf-first ",getColumnClass(column),cls,'" title="',(column.format.aggregate||"").capitalize(),'" colId="',column.id,'">','<span class="blist-tf-value">',val||"","</span></div>")},i=0;i<columns.length;i++){var col=columns[i];$.isBlank(col.visibleChildColumns)?renderColFooter(col):(html.push('<div class="blist-tf blist-opener ',id,'-opener"></div>'),options.showRowHandle&&html.push('<div class="'+getColumnClass(rowHandleColumn)+' blist-tf blist-table-row-handle"></div>'),_.each(col.visibleChildColumns,function(cc){renderColFooter(cc)}),options.showAddColumns&&html.push('<div class="blist-tf blist-column-adder"></div>'))}options.showGhostColumn&&html.push('<div class="blist-tf blist-table-ghost ',columns.length<1?"blist-tf-first ":"",ghostClass,'"></div>'),showAgg?($footer.html(html.join("")),$footerScrolls.show(),$lockedFooter.show()):($footerScrolls.hide(),$lockedFooter.hide());var lockedHtml="";_.each(lockedColumns,function(c){lockedHtml+='<div class="blist-tf '+(c.cls||"")+" "+getColumnClass(c)+'"><span class="blist-tf-value">'+(c.footerText||"")+"</span></div>"}),$lockedFooter.html(lockedHtml),pendingAggs=!1};model.getAggregates(function(){_.defer(gotAggs)})&&(pendingAggs=!0)}},currentPageText=function(){return $.t("controls.grid.viewing_current_page",{current:$.commaify(model.currentBucketIndexOrUndefined()+1),total:$.commaify(model.totalBuckets())})},handlePageChange=function(pageChangeOptions){(pageChangeOptions||{}).goToBottom?(updateLayout(),$scrolls.scrollTop($scrolls[0].scrollHeight)):$scrolls.scrollTop(0),renderRows(),$pagination.find(".info").text(currentPageText()),$pagination.find(".start, .previous").toggleClass("disabled",model.inFirstBucket()).end().find(".next, .end").toggleClass("disabled",model.inLastBucket()).end().find(".rowCount").text($.t("controls.grid.row_count",{count:$.commaify(model.dataLength())}))},renderPagination=function(){var $outsidePagination=$outside.find(".blist-table-pagination");if(model.usingBuckets()){$outsidePagination.show();var rowCount={_:"li",className:"rowCount",contents:$.t("controls.grid.row_count",{count:$.commaify(model.dataLength())})},bucketSize={_:"li",className:"bucketSize",contents:$.t("controls.grid.page_size",{pageSize:$.commaify(model.view.bucketSize)})},buttonBlock=function(clsName){return{_:"li",contents:[{_:"a",href:"#"+clsName,className:[clsName,"button"].join(" "),contents:[{_:"span",className:"icon"}],title:$.t("controls.grid.{0}_page".format(clsName))}]}};$outsidePagination.html($.tag2({_:"ul",className:"navigation",contents:[rowCount,buttonBlock("start"),buttonBlock("previous"),{_:"li",className:"info",contents:currentPageText()},buttonBlock("next"),buttonBlock("end"),bucketSize]})),model.totalBuckets()<=1&&$outsidePagination.find("li:not(.rowCount)").remove(),$outsidePagination.find(".start, .previous").toggleClass("disabled",model.inFirstBucket()).end().find(".next, .end").toggleClass("disabled",model.inLastBucket()),$(".button",$outsidePagination).click(function(e){var $button=$(this);if(e.preventDefault(),!$button.is(".disabled"))switch($.hashHref($button.attr("href"))){case"start":model.setRowBucket(0,"normal"),handlePageChange();break;case"previous":model.setRowBucket(model.currentBucket.start-1),handlePageChange();break;case"next":model.setRowBucket(model.currentBucket.finish+1),handlePageChange();break;case"end":model.setRowBucket(model.dataLength(),"reversed"),handlePageChange({goToBottom:!0})}})}else $outsidePagination.hide()},showNoResults=function(doShow){$noResults.toggleClass("hide",!doShow)},renderedRows={},dirtyRows={},rowIndices={},renderRows=function(){var i;if(model){begin("renderRows.setup");var start=Math.floor($scrolls.scrollTop()/renderScaling),stop=Math.ceil(start+1.5*pageSize);start<0&&(start=0),stop>model.length()&&(stop=model.length());var renderHeight=(stop-start)*rowOffset,renderTop=start*renderScaling,insideHeight=inside.height();$footerScrolls.is(":visible")&&(insideHeight-=$footerScrolls.outerHeight()-1),$pagination.is(":visible")&&(insideHeight-=$pagination.outerHeight()-1),renderTop+renderHeight>insideHeight&&(renderTop=insideHeight-renderHeight),end("renderRows.setup");var cleanRow=function(dirtyRowId,rowSet){if(rowSet[dirtyRowId]){var row=rowSet[dirtyRowId].row;void 0!==row&&row.parentNode.removeChild(row),void 0!==(row=rowSet[dirtyRowId].locked)&&row.parentNode.removeChild(row),delete rowSet[dirtyRowId]}};begin("renderRows.destroy");var bucketStart=start+model.currentBucketStart();for(var rowID in renderedRows)cleanRow(rowID,renderedRows);for(rowID in dirtyRows)cleanRow(rowID,dirtyRows);var dirtyIds=_.keys(dirtyRows);for(i=0;i<dirtyIds.length;i++)rowID=dirtyIds[i],$.isBlank(model.getByID(rowID))&&cleanRow(rowID,dirtyRows);end("renderRows.destroy"),pendingTop=renderTop,prevTop=Math.round(parseFloat($render.css("top")));var rowsLoaded=function(rows){if($.isBlank(pendingTop)||Math.round(parseFloat($render.css("top")))!=Math.round(prevTop)||($render.css("top",pendingTop),$render.height(renderHeight),$lockedRender.css("top",pendingTop),$lockedRender.height(renderHeight),setTop=pendingTop,pendingTop=void 0,prevTop=Math.round(parseFloat($render.css("top")))),Math.round(setTop)==Math.round(renderTop)){var row,rowIndex,badRows=[],html=[],lockedHtml=[];for(begin("renderRows.render"),i=0;i<rows.length;i++)if(row=rows[i],rowID=row.id,rowIndex=model.index(row),renderedRows[rowID]&&rowIndices[rowID]==rowIndex+bucketStart){$(renderedRows[rowID].row).css("top",(rowIndex-start)*rowOffset);var locked=renderedRows[rowID].locked;void 0!==locked&&$(locked).css("top",(rowIndex-start)*rowOffset)}else renderedRows[rowID]&&badRows.push(rowID),rowRenderFn(html,rowIndex-start,rowIndex,row),null!=rowLockedRenderFn&&rowLockedRenderFn(lockedHtml,rowIndex-start,row.index,row),rowIndices[rowID]=rowIndex;for(end("renderRows.render"),i=0;i<badRows.length;i++)cleanRow(badRows[i],renderedRows);begin("renderRows.appendLocked"),function(html){appendUtilDOM.innerHTML=html,function(){for(;appendUtilDOM.firstChild;){var row=appendUtilDOM.firstChild,rowID=row.id.substring(id.length+2);void 0===renderedRows[rowID]&&(renderedRows[rowID]={}),renderedRows[rowID].locked=row,void 0!==dirtyRows[rowID]?$lockedRender[0].replaceChild(row,dirtyRows[rowID].locked):$lockedRender[0].appendChild(row)}}()}(lockedHtml.join("")),end("renderRows.appendLocked"),begin("renderRows.append"),function(html){begin("appendRows.render"),appendUtilDOM.innerHTML=html,end("appendRows.render"),begin("appendRows.append"),function(){for(;appendUtilDOM.firstChild;){var row=appendUtilDOM.firstChild,rowID=row.id.substring(id.length+2);renderedRows[rowID]||(renderedRows[rowID]={}),renderedRows[rowID].row=row,dirtyRows[rowID]?(renderDOM.replaceChild(row,dirtyRows[rowID].row),delete dirtyRows[rowID]):renderDOM.appendChild(row)}}(),end("appendRows.append")}(html.join("")),end("renderRows.append"),begin("renderRows.rowMods"),null!==options.rowMods&&options.rowMods(renderedRows),end("renderRows.rowMods"),begin("renderRows.cellNav"),cellNav&&(updateCellNavCues(),expandActiveCell()),end("renderRows.cellNav"),begin("renderRows.selection"),$.isBlank(hotRowID)||makeHotRow(hotRowID),updateRowSelection(),end("renderRows.selection")}};start!=stop?(model.loadRows(start,stop,function(r){rowsLoaded(r)}),showNoResults(!1)):showNoResults(!0)}},updateRowSelection=function(){begin("rowSelection.removeSelect.inside"),inside.find(".blist-select-row").removeClass("blist-select-row"),end("rowSelection.removeSelect.inside"),begin("rowSelection.removeSelect.locked"),$locked.find(".blist-select-row").removeClass("blist-select-row"),end("rowSelection.removeSelect.locked"),begin("rowSelection.addSelect"),_.each((model.view.highlightTypes||{}).select,function(v,k){$("#"+id+"-r"+k).addClass("blist-select-row"),$("#"+id+"-l"+k).addClass("blist-select-row")}),end("rowSelection.addSelect"),begin("rowSelection.cellNav"),updateCellNavCues(),end("rowSelection.cellNav")},initRows=function(){begin("initRows.handle"),handleDigits!=calculateHandleDigits()&&(initMeta(),renderHeader(),renderFooter(),renderPagination()),end("initRows.handle"),begin("initRows.cleaning"),$lockedRender[0].innerHTML="",$render[0].innerHTML="",renderedRows={},dirtyRows={},end("initRows.cleaning"),updateLayout()},updateRows=function(rows){rows=$.makeArray(rows);for(var i=0;i<rows.length;i++){var rowID=rows[i].id,rendered=renderedRows[rowID];rendered&&(delete renderedRows[rowID],dirtyRows[rowID]=rendered)}updateLayout(),model.dataLength()<0&&model.loadRows(0,50)},finishColumnChoose=function(){$outside.css("cursor","auto"),$outside.find(".disabled-overlay, .select-overlay").remove()},table=this;$this.bind("dataset_ready.table",function(event,newModel){var _doLoad,isReady=function(){dsReady||(initMeta(),renderHeader(),renderFooter(),renderPagination(),initRows(),$this.bind("columns_changed.table",function(){initMeta(),renderHeader(),renderFooter(),renderPagination(),initRows()}).bind("rows_changed.table",function(){begin("updateRows"),initRows(),model.usingBuckets()&&model.setRowBucket(0,"normal"),renderPagination(),end("updateRows")}).bind("selection_change.table",function(selectionChangeEvent,rows){begin("selectionChange"),updateRowSelection(rows),end("selectionChange")}).bind("show.table",function(){initMeta(),renderHeader(),renderFooter(),renderPagination(),initRows()})),dsReady=!0,updateLayout(),$.isBlank(curView)||curView.unbind(null,null,table),curView=model.view,model.view.bind("row_change",function(rows){updateRows(rows)},table).bind("query_change",updateHeader,table).bind("column_resized",configureWidths,table).bind("column_totals_changed",function(){_.defer(renderFooter)},table)};(model=newModel).dataLength()<0?(_doLoad=function(){model.loadRows(0,50,function(){isReady()},function(arg){(arg||{}).cancelled&&_doLoad()})})():isReady()}),$this.blistModel(options.model);var isDisabled=!1;$this.data("blistTableObj",new function(){this.getSelectedColumns=function(){return cellNav?cellNav.getSelectedColumns():{}},this.disable=function(){isDisabled=!0,$this.addClass("disabled"),clearCellNav()},this.enable=function(){isDisabled=!1,$this.removeClass("disabled"),finishColumnChoose()},this.enterColumnChoose=function(types,callback){!function(types,callback){var allTypes=_.isEmpty(types);$outside.css("cursor","crosshair"),$lockedScrolls.append('<div class="disabled-overlay"></div>');var rightPos=0;_.each(columns,function(c){var $c=$(c.dom),left=$c.position().left,divClass="disabled-overlay";(allTypes||_.include(types,c.renderTypeName))&&(divClass="select-overlay");var $h=$('<div class="'+divClass+" col-"+c.id+'"></div>').width($c.outerWidth()).css("left",left).hover(function(){$h.add($f).add($m).addClass("overlay-hover")},function(){$h.add($f).add($m).removeClass("overlay-hover")});(allTypes||_.include(types,c.renderTypeName))&&$h.click(function(){_.isFunction(callback)&&callback(c)});var $f=$h.clone(!0),$m=$h.clone(!0).css("left",left+lockedWidth);$header.append($h),$footer.append($f),inside.append($m),rightPos=$c.outerWidth()+$c.position().left});var $or=$('<div class="disabled-overlay"></div>').width($header.width()-rightPos).css("left",rightPos);$header.append($or),$footer.append($or.clone()),inside.append($or.clone().css("left",rightPos+lockedWidth).width($or.width()-lockedWidth))}(types=$.makeArray(types),callback)},this.exitColumnChoose=function(){finishColumnChoose()},this.setCommentCell=function(rowId,tcId){customCellClasses[rowId]=customCellClasses[rowId]||{};var colId=model.view.columnForTCID(tcId).id;customCellClasses[rowId][colId]=customCellClasses[rowId][colId]||[],customCellClasses[rowId][colId].push("comments-active"),updateRows([{id:rowId}])},this.clearCommentCell=function(rowId,tcId){var colId=model.view.columnForTCID(tcId).id;$.isBlank(customCellClasses[rowId])||$.isBlank(customCellClasses[rowId][colId])||(customCellClasses[rowId][colId]=_.without(customCellClasses[rowId][colId],"comments-active"),updateRows([{id:rowId}]))}})},blistTableDefaults={cellExpandEnabled:!0,cellNav:!1,columnDrag:!1,disableLastColumnResize:!1,editEnabled:!1,generateHeights:!0,ghostMinWidth:20,headerMods:function(){},manualResize:!1,resizeHandleAdjust:3,rowHandleRenderer:function(){},rowHandleWidth:1,rowMods:function(){},selectionEnabled:!0,showGhostColumn:!1,showRowNumbers:!0,showRowHandle:!1,showAddColumns:!1};$.fn.extend({blistTable:function(options){return this.each(function(){$(this).is(".blist-table")||makeTable.apply(this,[$.extend({},blistTableDefaults,options)])})},blistTableAccessor:function(){return this.data("blistTableObj")}})}(jQuery)},1587:function(module,exports,__webpack_require__){"use strict";var $;_.get(window,"socrata.enable_2017_grid_view_refresh",!1)||(blist.namespace.fetch("blist.data"),$=jQuery,blist.data.Model=function(){var trCols,self=this,curOptions={blankRow:!1,filterMinChars:3,pageSize:50,view:null},specialCount=0,specialRows={},specialLookup={},expandedRows={},listeners=[],undoBuffer=[],redoBuffer=[];this.options=function(newOpt){if(newOpt){var wasDS=!$.isBlank(this.view);wasDS&&this.view.unbind(null,null,this),$.extend(curOptions,newOpt),$.isBlank(curOptions.view)||(this.view=curOptions.view,this.view.bind("row_count_change",function(){configureActive()},this).bind("clear_temporary",function(){resetUndo(),collapseAll(),configureActive()},this).bind("query_change",function(){resetUndo(),collapseAll(),configureActive()},this).bind("columns_changed",function(){resetUndo(),trCols=null,$(listeners).trigger("columns_changed")},this).bind("row_change",function(rows,fullReset){_.each($.makeArray(rows),function(r){fullReset?resetChildRows(r):r.expanded&&self.view.trigger("row_change",[r.childRows])})},this),$(listeners).trigger("dataset_ready",[self])),wasDS&&(trCols=null,resetUndo(),collapseAll(),configureActive(),$(listeners).trigger("columns_changed"))}return this},this.canRead=function(){return this.view&&this.view.hasRight(blist.rights.view.READ)},this.canWrite=function(){return this.view&&this.view.hasRight(blist.rights.view.WRITE)&&!this.view.isGrouped()},this.canAdd=function(){return this.view&&this.view.hasRight(blist.rights.view.ADD)&&!this.view.isGrouped()},this.canDelete=function(){return this.view&&this.view.hasRight(blist.rights.view.DELETE)&&!this.view.isGrouped()},this.useBlankRows=function(){return curOptions.blankRow&&self.canAdd()&&self.canWrite()},this.addListener=function(listener){-1==$.inArray(listener,listeners)&&listeners.push(listener)},this.removeListener=function(listener){var pos=$.inArray(listener,listeners);-1==pos&&(listeners=listeners.splice(pos,1))},this.loadRows=function(start,stop,successCallback,errorCallback){if($.isBlank(this.view))return!1;this.usingBuckets()?(_.isNull(this.currentBucket)&&this.setRowBucket(start),start+=this.currentBucket.start,stop+=this.currentBucket.start):this.currentBucket={start:0};var specToStop=countSpecialTo(stop,!0),adjStop=stop-specToStop,specToStart=countSpecialTo(start,!0),adjStart=start-specToStart,gotRows=function(modelRows){if(specToStart!=specToStop)for(var i=start;i<stop;i++)$.isBlank(specialRows[i])||modelRows.splice(i-start,0,specialRows[i]);_.isFunction(successCallback)&&successCallback(modelRows)};return adjStop==adjStart?gotRows([]):this.view.getRows(adjStart,adjStop-adjStart,gotRows,errorCallback,this.currentBucket.sortOrderForRequest),!0},this.getAggregates=function(callback){return!$.isBlank(this.view)&&(this.view.getAggregates(callback),!0)},this.removeRows=function(delRowIds,skipUndo){delRowIds=$.makeArray(delRowIds);var rows=_.map(delRowIds,function(rId){return self.getByID(rId)});skipUndo||this.addUndoItem({type:"delete",rows:rows}),_.each(rows,function(r){self.unselectRow(r),r.expanded&&self.expand(r,!1)}),this.view.removeRows(delRowIds)},this.removeChildRows=function(fakeRows,parCol,skipUndo){var removedRows=[],removedByPar={};_.each($.makeArray(fakeRows),function(fr){for(var parRow=fr.parent,subRow=self.getRowValue(fr,parCol),subRowSet=self.getRowValue(parRow,parCol),j=0;j<subRowSet.length;j++)if(subRow.id==subRowSet[j].id){subRow.origPosition=j,removedRows.push({row:subRow,parentRow:parRow}),removedByPar[parRow.id]=removedByPar[parRow.id]||[],removedByPar[parRow.id].push(subRow.id);break}}),skipUndo||this.addUndoItem({type:"childDelete",rows:removedRows,parentColumn:parCol}),_.each(removedByPar,function(cr,parId){self.view.removeRows(cr,parId,parCol.id)})};var isInvalid=function(row,column){return $.isBlank(column.parentColumn)||(row=row.data[column.parentColumn.lookup]),(row.invalid||{})[column.lookup]},getRawValue=function(row,column){return $.isBlank(column.parentColumn)||(row=row.data[column.parentColumn.lookup]),row.data[column.lookup]};this.getRowValue=function(row,column){if(!$.isBlank(row))return isInvalid(row,column)?null:getRawValue(row,column)},this.getInvalidValue=function(row,column){if(!$.isBlank(row))return isInvalid(row,column)?getRawValue(row,column):null},this.isCellError=function(row,column){return $.isBlank(column.parentColumn)||(row=row.data[column.parentColumn.lookup]),row.error[column.lookup]};var resetChildRows=function(row){if(row.expanded){self.expand(row,!1,!0);var allRows=row.childRows;delete row.childRows,self.expand(row,!0,!0),allRows=allRows.concat(row),self.view.trigger("row_change",[allRows])}else delete row.childRows};this.saveRowValue=function(value,row,column,isValid,skipUndo){if(!$.isBlank(this.view)){var parRow,childRow,parCol,isCreate=!1;if("blank"==row.type&&(delete row.type,this.view.newBackend&&this.view.rowIdentifierColumn==column?row.id=this.view.createRowWithPK(value):row.id=this.view.createRow(),isCreate=!0,row=this.getByID(row.id),skipUndo||this.addUndoItem({type:"create",rows:[row]})),!$.isBlank((column||{}).parentColumn)&&(parCol=column.parentColumn,childRow=self.getRowValue(row,parCol),parRow=row.parent,isCreate="blank"==childRow.type)){delete childRow.type;var curRowI=this.index(row);"blank"==parRow.type&&(parRow=this.saveRowValue(null,parRow,null,!0),skipUndo=!0),childRow.id=this.view.createRow(null,parRow.id,parCol.id),childRow=self.getRowValue(row,parCol),row=this.get(curRowI),skipUndo||this.addUndoItem({type:"childCreate",rows:[row],parentColumn:parCol})}if(!skipUndo&&!isCreate){var prevValue,prevValueInvalid=!1;$.isBlank(column)||(prevValue=this.getRowValue(row,column),$.isBlank(prevValue)&&(prevValue=this.getInvalidValue(row,column),prevValueInvalid=!$.isBlank(prevValue))),this.addUndoItem({type:"edit",column:column,row:row,value:prevValue,invalid:prevValueInvalid})}return $.isBlank(column)||($.isBlank(childRow)?(this.view.setRowValue(value,row.id,column.id,!isValid),row.valid&&this.view.saveRow(row.id)):(this.view.setRowValue(value,childRow.id,column.id,!isValid,parRow.id,parCol.id),this.view.saveRow(childRow.id,parRow.id,parCol.id))),row}};var undeleteChildRow=function(row,parentRow,parentColumn){row.index=row.origPosition,self.view.createRow(row,parentRow.id,parentColumn.id)},doUndoRedo=function(buffer){if(buffer.length<1)return null;var item=buffer.pop(),oppItem=null;switch(item.type){case"edit":var curValue=self.getRowValue(item.row,item.column),valueIsInvalid=!1;$.isBlank(curValue)&&(curValue=self.getInvalidValue(item.row,item.column),valueIsInvalid=!$.isBlank(curValue)),oppItem={type:"edit",value:curValue,invalid:valueIsInvalid,row:item.row,column:item.column},self.saveRowValue(item.value,item.row,item.column,!item.invalid,!0);break;case"create":oppItem={type:"delete",rows:item.rows},self.removeRows(_.pluck(item.rows,"id"),!0);break;case"childCreate":oppItem={type:"childDelete",rows:_.map(item.rows,function(r){return{parentRow:r.parent,row:fakeRowToChild(r,item.parentColumn)}}),parentColumn:item.parentColumn},self.removeChildRows(item.rows,item.parentColumn,!0);break;case"delete":oppItem={type:"create",rows:[]},item.rows.reverse(),_.each(item.rows,function(r){oppItem.rows.push(function(row){var undeleteChildren=[];_.each(self.view.columnsForType("nested_table",!0),function(c){row.data[c.lookup]instanceof Array&&(_.each(row.data[c.lookup],function(cr,i){cr.origPosition=i,undeleteChildren.push({row:cr,parentColumn:c})}),delete row.data[c.lookup])});var newId=self.view.createRow(row);return row=self.view.rowForID(newId),_.each(undeleteChildren,function(cr){undeleteChildRow(cr.row,row,cr.parentColumn)}),row}(r))});break;case"childDelete":var reversedRows=item.rows.slice();reversedRows.reverse(),_.each(reversedRows,function(r){undeleteChildRow(r.row,r.parentRow,item.parentColumn)}),oppItem={type:"childCreate",rows:_.map(item.rows,function(r){return childRowToFake(r.parentRow,r.row.origPosition)}),parentColumn:item.parentColumn}}return oppItem};this.addUndoItem=function(itemHash){redoBuffer.length=0,undoBuffer.push(itemHash),this.undoRedoChange()},this.undo=function(){var oppItem=doUndoRedo(undoBuffer);null!==oppItem&&(redoBuffer.push(oppItem),this.undoRedoChange())},this.redo=function(){var oppItem=doUndoRedo(redoBuffer);null!==oppItem&&(undoBuffer.push(oppItem),this.undoRedoChange())},this.canUndo=function(){return undoBuffer.length>0},this.canRedo=function(){return redoBuffer.length>0};var resetUndo=function(){redoBuffer.length=0,undoBuffer.length=0,self.undoRedoChange()},childRowToFake=function(parentRow,childRowPos){return $.isBlank(parentRow.childRows)&&getChildRows(parentRow),parentRow.childRows[childRowPos]},fakeRowToChild=function(fakeRow,parentColumn){return fakeRow.data[parentColumn.lookup]};this.selectionChange=function(rows){$(listeners).trigger("selection_change",[rows])},this.undoRedoChange=function(){$(listeners).trigger("undo_redo_change")},this.index=function(row){if(!$.isBlank(this.view))return $.isBlank(specialLookup[row.id])?row.index+countSpecialTo(row.index+1)-this.currentBucketStart():row.index},this.get=function(index){if(!$.isBlank(this.view))return specialRows[index+this.currentBucketStart()]||this.view.rowForIndex(index-countSpecialTo(index,!0)+this.currentBucketStart())},this.getByID=function(id){if(!$.isBlank(this.view))return specialLookup[id]||this.view.rowForID(id)},this.columns=function(){return $.isBlank(this.view)?null:($.isBlank(trCols)&&function(){trCols=[[],[]];var fillFor=[],addFill=function(){fillFor.length>0&&trCols[1].push({renderTypeName:"fill",fillFor:fillFor,id:"fill"+_.uniqueId()}),fillFor=[]};_.each(self.view.visibleColumns,function(c){trCols[0].push(c),"nested_table"==c.dataTypeName?(addFill(),trCols[1].push(c)):fillFor.push(c)}),addFill()}(),trCols)},this.columnForID=function(id){if($.isBlank(this.view))return null;var col=this.view.columnForID(id);return $.isBlank(col)&&_.each(this.view.columnsForType("nested_table"),function(c){col=col||c.childColumnForID(id)}),col},this.length=function(accountForBuckets){return _.isUndefined(accountForBuckets)&&(accountForBuckets=!0),accountForBuckets&&this.usingBuckets()&&!_.isNull(this.currentBucket)?Math.min(this.view.bucketSize,this.dataLength()-this.currentBucketStart()+specialCount):this.dataLength()+specialCount},this.dataLength=function(){var tr=(this.view||{}).totalRows();return $.isBlank(tr)?-1:tr},this.level=function(level){return $.isBlank(this.view)||$.isBlank(trCols)?null:trCols[level]},this.nextInLevel=function(from,backward){var pos=from,level=0;if($.isBlank(specialRows[pos])||(level=specialRows[pos].level||0),backward){for(;--pos>=0;)if(((this.get(pos)||{}).level||0)==level)return pos}else for(var end=this.length();++pos<end;){var r=this.get(pos);if($.isBlank(r)||(r.level||0)==level)return pos}return null},this.hasSelectedRows=function(){return $.subKeyDefined(this.view,"highlightTypes.select")&&!_.isEmpty(this.view.highlightTypes.select)},this.toggleSelectRow=function(row){$.subKeyDefined(this.view,"highlightTypes.select."+row.id)?this.unselectRow(row):this.selectRow(row)},this.selectRow=function(row){"blank"!=row.type&&(this.view.highlightRows(row,"select"),$(listeners).trigger("display_row",[{row:row}]))},this.unselectRow=function(row){this.view.unhighlightRows(row,"select"),$(listeners).trigger("display_row",[{row:null}])},this.unselectAllRows=function(){this.view.highlightRows(null,"select"),$(listeners).trigger("display_row",[{row:null}])},this.selectRowsTo=function(row){if(!this.hasSelectedRows())return this.selectRow(row);var minIndex=_.min(_.map(this.view.highlightTypes.select,function(selected){return self.index(selected)})),curIndex=this.index(row),maxIndex=curIndex;curIndex<minIndex&&(maxIndex=minIndex,minIndex=curIndex);for(var selRows=[],i=minIndex;i<=maxIndex;i++){var curRow=this.get(i);$.isBlank(curRow)||"blank"==curRow.type||selRows.push(curRow)}this.view.highlightRows(selRows,"select")};var getChildRows=function(row){if(row.childRows)return row.childRows;for(var cols=self.columns()[row.level||0],childRows=row.childRows=[],childLevel=(row.level||0)+1,i=0;i<cols.length;i++){var col=cols[i];if(!$.isBlank(col.visibleChildColumns)){var cell=row.data[col.lookup];if(!$.isBlank(cell)||self.useBlankRows())for(var numCells=((cell=cell||[]).length||0)+(self.useBlankRows()?1:0),j=0;j<numCells;j++){var childRow=childRows[j];childRow||((childRow=childRows[j]={data:{}}).id="t"+_.uniqueId(),childRow.level=childLevel,childRow.parent=row,childRow.index=-1),childRow.data[col.lookup]=cell[j],childRow.data[col.lookup]||(childRow.data[col.lookup]={data:{},invalid:{},changed:{},error:{}},childRow.data[col.lookup].type="blank")}}}return childRows.length&&(childRows[childRows.length-1].groupLast=!0),childRows};this.expand=function(row,open,skipEvent){if(void 0!==row&&(void 0===open&&(open=!row.expanded),open!==row.expanded)){if(open){var childRows=getChildRows(row);$.addItemsToObject(specialRows,childRows,this.index(row)+1),_.each(childRows,function(cr){specialLookup[cr.id]=cr}),specialCount+=childRows.length,expandedRows[row.id]=!0}else row.childRows&&row.childRows.length&&($.removeItemsFromObject(specialRows,this.index(row)+1,row.childRows.length),specialCount-=row.childRows.length,_.each(row.childRows,function(cr){delete specialLookup[cr.id]})),delete expandedRows[row.id];if(row.expanded=open,!skipEvent){var rows=[row];row.expanded||$.isBlank(row.childRows)||(rows=rows.concat(row.childRows)),this.view.trigger("row_change",[rows])}}},this.currentBucket=null,this.usingBuckets=function(){return this.view.usingBuckets()},this.getLastIndex=function(){if(this.usingBuckets()){var lastBucket=this.view.getRowBucket(this.dataLength());return this.dataLength()-lastBucket.start}return this.length()},this.setRowBucket=function(newBucketOrIndex,newSortOrder){_.isUndefined(newSortOrder)||this.setSortOrder(newSortOrder);var sortOrderForRequest=(this.currentBucket||{}).sortOrderForRequest,error=function(){_.isFunction(_.get(console,"error"))&&console.error("setBucket called with invalid bucket: {0}".format(newBucketOrIndex))};return _.isPlainObject(newBucketOrIndex)?_.has(newBucketOrIndex,"start")&&_.has(newBucketOrIndex,"finish")?this.currentBucket=newBucketOrIndex:error():_.isNumber(newBucketOrIndex)?this.currentBucket=this.view.getRowBucket(newBucketOrIndex):error(),this.currentBucket.sortOrderForRequest=sortOrderForRequest,this.currentBucket},this.setSortOrder=function(sortOrderForRequest){_.isNull(this.currentBucket)||(this.currentBucket.sortOrderForRequest=sortOrderForRequest)},this.currentBucketStart=function(){return _.isNull(this.currentBucket)?0:this.currentBucket.start},this.currentBucketIndexOrUndefined=function(){if(!_.isNull(this.currentBucket))return this.view.bucketIndex(this.currentBucket.start)},this.totalBuckets=function(){return this.view.totalBuckets()},this.inFirstBucket=function(){if(!_.isNull(this.currentBucket))return 0===this.currentBucket.start},this.inLastBucket=function(){if(!_.isNull(this.currentBucket))return this.currentBucket.finish>=this.dataLength()};var configureActive=function(){if(removeSpecialRows(),doExpansion(),self.useBlankRows()){var blankRow={invalid:{},changed:{},error:{},data:{},metadata:{},type:"blank",id:"blank"};blankRow.index=self.getLastIndex(),specialRows[self.length(!1)]=blankRow,specialLookup[blankRow.id]=blankRow,specialCount++}self.unselectAllRows(),$(listeners).trigger("rows_changed")},countSpecialTo=function(max,isAbsolute){var count=0;$.isBlank(max)&&(max=self.dataLength());var i=0;for(max>specialCount&&(_.each(specialRows,function(r,index){index<max&&count++}),i=max,isAbsolute||(max+=count));i<max;)$.isBlank(specialRows[i])||(count++,isAbsolute||max++),i++;return count},removeSpecialRows=function(){var removed=specialCount>0;return specialRows={},specialLookup={},specialCount=0,removed},collapseAll=function(){_.each(_.keys(expandedRows),function(rId){self.expand(self.getByID(rId),!1,!0)})},doExpansion=function(){var missingRows=[];return _.each(expandedRows,function(v,rId){var r=self.getByID(rId);if($.isBlank(r))missingRows.push(rId);else{var childRows=getChildRows(r);$.addItemsToObject(specialRows,childRows,self.index(r)+1),_.each(childRows,function(cr){specialLookup[cr.id]=cr}),specialCount+=childRows.length,r.expanded=!0}}),_.each(missingRows,function(rId){delete expandedRows[rId]}),!_.isEmpty(expandedRows)};resetUndo()},$.fn.extend({blistModel:function(model){if(model)return this.each(function(){var currentModel=$(this).data("blistModel");currentModel&&currentModel.removeListener(this)}),this.data("blistModel",model),this.each(function(){model.addListener(this)}),model;var thisModel=this.data("blistModel");return thisModel||this.blistModel(new blist.data.Model)}}))},1588:function(module,exports){(function(){window.WKT=function(){var numberRegexp=/[-+]?([0-9]*\.[0-9]+|[0-9]+)([eE][-+]?[0-9]+)?/,tuples=new RegExp("^"+numberRegexp.source+"\\s"+numberRegexp.source+"(\\s"+numberRegexp.source+")?");return{parse:function(_){var obj,parts=_.split(";"),srid=(_=parts.pop(),(parts.shift()||"").split("=").pop()),i=0;function $(re){var match=_.substring(i).match(re);return match?(i+=match[0].length,match[0]):null}function white(){$(/^\s*/)}function multicoords(){white();for(var elem,depth=0,rings=[],stack=[rings],pointer=rings;elem=$(/^(\()/)||$(/^(\))/)||$(/^(\,)/)||$(tuples);){if("("==elem)stack.push(pointer),pointer=[],stack[stack.length-1].push(pointer),depth++;else if(")"==elem){if(0===pointer.length)return null;if(!(pointer=stack.pop()))return null;if(0==--depth)break}else if(","===elem)pointer=[],stack[stack.length-1].push(pointer);else{if(!elem.split(/\s/g).every(parseFloat))return null;Array.prototype.push.apply(pointer,elem.split(/\s/g).map(parseFloat))}white()}return 0!==depth?null:rings}function coords(){for(var item,pt,list=[];pt=$(tuples)||$(/^(\,)/);)","==pt?(list.push(item),item=[]):pt.split(/\s/g).every(parseFloat)&&(item||(item=[]),Array.prototype.push.apply(item,pt.split(/\s/g).map(parseFloat))),white();return item?(list.push(item),list.length?list:null):null}function root(){return function(){if(!$(/^(point)/i))return null;if(white(),!$(/^(\()/))return null;var c=coords();return c?(white(),$(/^(\))/)?{type:"Point",coordinates:c[0]}:null):null}()||function(){if(!$(/^(linestring)/i))return null;if(white(),!$(/^(\()/))return null;var c=coords();return c&&$(/^(\))/)?{type:"LineString",coordinates:c}:null}()||function(){if(!$(/^(polygon)/i))return null;white();var c=multicoords();return c?{type:"Polygon",coordinates:c}:null}()||function(){if(!$(/^(multipoint)/i))return null;white();var c=multicoords();return c?(white(),{type:"MultiPoint",coordinates:c}):null}()||function(){if(!$(/^(multilinestring)/i))return null;white();var c=multicoords();return c?(white(),{type:"MultiLineString",coordinates:c}):null}()||function(){if(!$(/^(multipolygon)/i))return null;white();var c=multicoords();return c?{type:"MultiPolygon",coordinates:c}:null}()||function(){var geometry,geometries=[];if(!$(/^(geometrycollection)/i))return null;if(white(),!$(/^(\()/))return null;for(;geometry=root();)geometries.push(geometry),white(),$(/^(\,)/),white();return $(/^(\))/)?{type:"GeometryCollection",geometries:geometries}:null}()}return(obj=root())&&srid.match(/\d+/)&&(obj.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+srid}}),obj},stringify:function stringify(gj){function pairWKT(c){return 2===c.length?c[0]+" "+c[1]:3===c.length?c[0]+" "+c[1]+" "+c[2]:void 0}function ringWKT(r){return r.map(pairWKT).join(", ")}function ringsWKT(r){return r.map(ringWKT).map(wrapParens).join(", ")}function wrapParens(s){return"("+s+")"}switch("Feature"===gj.type&&(gj=gj.geometry),gj.type){case"Point":return"POINT ("+pairWKT(gj.coordinates)+")";case"LineString":return"LINESTRING ("+ringWKT(gj.coordinates)+")";case"Polygon":return"POLYGON ("+ringsWKT(gj.coordinates)+")";case"MultiPoint":return"MULTIPOINT ("+ringWKT(gj.coordinates)+")";case"MultiPolygon":return"MULTIPOLYGON ("+gj.coordinates.map(ringsWKT).map(wrapParens).join(", ")+")";case"MultiLineString":return"MULTILINESTRING ("+ringsWKT(gj.coordinates)+")";case"GeometryCollection":return"GEOMETRYCOLLECTION ("+gj.geometries.map(stringify).join(", ")+")";default:throw new Error("stringify requires a valid GeoJSON Feature or geometry object as input")}}}}()}).call(window)},1589:function(module,exports,__webpack_require__){__webpack_require__(1588),__webpack_require__(1587),__webpack_require__(1586),__webpack_require__(1585),__webpack_require__(760),__webpack_require__(759),__webpack_require__(128),__webpack_require__(1584),module.exports=__webpack_require__(1583)},5:function(module,exports){module.exports=jQuery}});
//# sourceMappingURL=shared-table-render.js.map